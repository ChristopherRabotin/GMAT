
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Propagation with the GMAT API &#8212; GMAT Tools and Extensions R2020a documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Bibliography" href="../../Bibliography.html" />
    <link rel="prev" title="State Management with the GMAT API" href="GMAT_States.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../Bibliography.html" title="Bibliography"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="GMAT_States.html" title="State Management with the GMAT API"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">GMAT Tools and Extensions R2020a documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../apiIndex.html" >DRAFT GMAT API Design and User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="notebooks.html" accesskey="U">API Notebook Walkthroughs</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="propagation-with-the-gmat-api">
<h1>Propagation with the GMAT API<a class="headerlink" href="#propagation-with-the-gmat-api" title="Permalink to this headline">¶</a></h1>
<p>This document walks you through the configuration and use of the GMAT
API for propagation.</p>
<div class="section" id="prepare-the-gmat-environment">
<h2>Prepare the GMAT Environment<a class="headerlink" href="#prepare-the-gmat-environment" title="Permalink to this headline">¶</a></h2>
<p>Before the API can be used, it needs to be loaded into the Python system
and initialized using a GMAT startup file. This can be done from the
GMAT bin folder by importing the gmatpy module, but using that approach
tends to leave pieces in the bin folder that may annoy other users.
Running from an outside folder takes a few steps, which have been
captured in the run_gmat.py file imported here:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">run_gmat</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-a-spacecraft">
<h2>Configure a Spacecraft<a class="headerlink" href="#configure-a-spacecraft" title="Permalink to this headline">¶</a></h2>
<p>We’ll need an object to propagate. Here’s a basic one:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sat</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;Spacecraft&quot;</span><span class="p">,</span><span class="s2">&quot;LeoSat&quot;</span><span class="p">)</span>

<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;DateFormat&quot;</span><span class="p">,</span> <span class="s2">&quot;UTCGregorian&quot;</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span> <span class="s2">&quot;27 Sep 2019 15:05:00.000&quot;</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;CoordinateSystem&quot;</span><span class="p">,</span> <span class="s2">&quot;EarthMJ2000Eq&quot;</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;DisplayStateType&quot;</span><span class="p">,</span> <span class="s2">&quot;Keplerian&quot;</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;SMA&quot;</span><span class="p">,</span> <span class="mi">7005</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;ECC&quot;</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;INC&quot;</span><span class="p">,</span> <span class="mf">28.5</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;RAAN&quot;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;AOP&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;TA&quot;</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>

<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;DryMass&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;Cd&quot;</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;Cr&quot;</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;DragArea&quot;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">sat</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;SRPArea&quot;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-forces">
<h2>Configure the Forces<a class="headerlink" href="#configure-the-forces" title="Permalink to this headline">¶</a></h2>
<p>Next we’ll set up a force model. For this example, we’ll use an Earth
8x8 potential model, with Sun and Moon point masses and Jacchia-Roberts
drag. In GMAT, forces are collected in the ODEModel class. That class is
scripted as a “ForceModel” in the script language. The API accepts
either. The force model is built and its (empty) contents displayed
using</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fm</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;ForceModel&quot;</span><span class="p">,</span> <span class="s2">&quot;TheForces&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">Help</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ForceModel</span>  <span class="n">TheForces</span>

   <span class="n">Field</span>                                   <span class="n">Type</span>   <span class="n">Value</span>
   <span class="o">--------------------------------------------------------</span>

   <span class="n">CentralBody</span>                           <span class="n">Object</span>   <span class="n">Earth</span>
   <span class="n">PrimaryBodies</span>                    <span class="n">ObjectArray</span>   <span class="p">{}</span>
   <span class="n">PolyhedralBodies</span>                 <span class="n">ObjectArray</span>   <span class="p">{}</span>
   <span class="n">PointMasses</span>                      <span class="n">ObjectArray</span>   <span class="p">{}</span>
   <span class="n">Drag</span>                                  <span class="n">Object</span>   <span class="kc">None</span>
   <span class="n">SRP</span>                                    <span class="n">OnOff</span>   <span class="n">Off</span>
   <span class="n">RelativisticCorrection</span>                 <span class="n">OnOff</span>   <span class="n">Off</span>
   <span class="n">ErrorControl</span>                            <span class="n">List</span>   <span class="n">RSSStep</span>
   <span class="n">UserDefined</span>                      <span class="n">ObjectArray</span>   <span class="p">{}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="add-the-potential-field">
<h2>Add the Potential Field<a class="headerlink" href="#add-the-potential-field" title="Permalink to this headline">¶</a></h2>
<p>In this example, the spacecraft is in Earth orbit. The largest force for
the model is the Earth gravity field. We’ll set it to an 8x8 field and
add it to the force model using the code</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An 8x8 JGM-3 Gravity Model</span>
<span class="n">earthgrav</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;GravityField&quot;</span><span class="p">)</span>
<span class="n">earthgrav</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;BodyName&quot;</span><span class="p">,</span><span class="s2">&quot;Earth&quot;</span><span class="p">)</span>
<span class="n">earthgrav</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;Degree&quot;</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">earthgrav</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;Order&quot;</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">earthgrav</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;PotentialFile&quot;</span><span class="p">,</span><span class="s2">&quot;JGM2.cof&quot;</span><span class="p">)</span>

<span class="c1"># Add forces into the ODEModel container</span>
<span class="n">fm</span><span class="o">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">earthgrav</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-the-other-forces">
<h2>Add the other forces<a class="headerlink" href="#add-the-other-forces" title="Permalink to this headline">¶</a></h2>
<p>Next we’ll build and add the Sun, Moon, and Drag forces, and then show
the completed force model.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The Point Masses</span>
<span class="n">moongrav</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;PointMassForce&quot;</span><span class="p">)</span>
<span class="n">moongrav</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;BodyName&quot;</span><span class="p">,</span><span class="s2">&quot;Luna&quot;</span><span class="p">)</span>
<span class="n">sungrav</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;PointMassForce&quot;</span><span class="p">)</span>
<span class="n">sungrav</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;BodyName&quot;</span><span class="p">,</span><span class="s2">&quot;Sun&quot;</span><span class="p">)</span>

<span class="c1"># Drag using Jacchia-Roberts</span>
<span class="n">jrdrag</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;DragForce&quot;</span><span class="p">)</span>
<span class="n">jrdrag</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;AtmosphereModel&quot;</span><span class="p">,</span><span class="s2">&quot;JacchiaRoberts&quot;</span><span class="p">)</span>

<span class="c1"># Build and set the atmosphere for the model</span>
<span class="n">atmos</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;JacchiaRoberts&quot;</span><span class="p">)</span>
<span class="n">jrdrag</span><span class="o">.</span><span class="n">SetReference</span><span class="p">(</span><span class="n">atmos</span><span class="p">)</span>

<span class="c1"># Add all of the forces into the ODEModel container</span>
<span class="n">fm</span><span class="o">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">moongrav</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">sungrav</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">jrdrag</span><span class="p">)</span>

<span class="n">fm</span><span class="o">.</span><span class="n">Help</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ForceModel</span>  <span class="n">TheForces</span>

   <span class="n">Field</span>                                   <span class="n">Type</span>   <span class="n">Value</span>
   <span class="o">--------------------------------------------------------</span>

   <span class="n">CentralBody</span>                           <span class="n">Object</span>   <span class="n">Earth</span>
   <span class="n">PrimaryBodies</span>                    <span class="n">ObjectArray</span>   <span class="p">{</span><span class="n">Earth</span><span class="p">}</span>
   <span class="n">PolyhedralBodies</span>                 <span class="n">ObjectArray</span>   <span class="p">{}</span>
   <span class="n">PointMasses</span>                      <span class="n">ObjectArray</span>   <span class="p">{</span><span class="n">Luna</span><span class="p">,</span> <span class="n">Sun</span><span class="p">}</span>
   <span class="n">Drag</span>                                  <span class="n">Object</span>   <span class="n">JacchiaRoberts</span>
   <span class="n">SRP</span>                                    <span class="n">OnOff</span>   <span class="n">Off</span>
   <span class="n">RelativisticCorrection</span>                 <span class="n">OnOff</span>   <span class="n">Off</span>
   <span class="n">ErrorControl</span>                            <span class="n">List</span>   <span class="n">RSSStep</span>
   <span class="n">UserDefined</span>                      <span class="n">ObjectArray</span>   <span class="p">{}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>In GMAT, the force model scripting shows the settings for each force. In
the API, you can examine the settings for the individual forces:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">earthgrav</span><span class="o">.</span><span class="n">Help</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GravityField</span>

   <span class="n">Field</span>                                   <span class="n">Type</span>   <span class="n">Value</span>
   <span class="o">--------------------------------------------------------</span>

   <span class="n">Degree</span>                               <span class="n">Integer</span>   <span class="mi">8</span>
   <span class="n">Order</span>                                <span class="n">Integer</span>   <span class="mi">8</span>
   <span class="n">StmLimit</span>                             <span class="n">Integer</span>   <span class="mi">100</span>
   <span class="n">PotentialFile</span>                       <span class="n">Filename</span>   <span class="n">JGM2</span><span class="o">.</span><span class="n">cof</span>
   <span class="n">TideFile</span>                            <span class="n">Filename</span>
   <span class="n">TideModel</span>                             <span class="n">String</span>   <span class="kc">None</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>or, with a little work, the scripting for the complete force model:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">GetGeneratingString</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Create</span> <span class="n">ForceModel</span> <span class="n">TheForces</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">CentralBody</span> <span class="o">=</span> <span class="n">Earth</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">PrimaryBodies</span> <span class="o">=</span> <span class="p">{</span><span class="n">Earth</span><span class="p">};</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">PointMasses</span> <span class="o">=</span> <span class="p">{</span><span class="n">Luna</span><span class="p">,</span> <span class="n">Sun</span><span class="p">};</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">SRP</span> <span class="o">=</span> <span class="n">Off</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">RelativisticCorrection</span> <span class="o">=</span> <span class="n">Off</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">ErrorControl</span> <span class="o">=</span> <span class="n">RSSStep</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">GravityField</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">Degree</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">GravityField</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">Order</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">GravityField</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">StmLimit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">GravityField</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">PotentialFile</span> <span class="o">=</span> <span class="s1">&#39;JGM2.cof&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">GravityField</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">TideModel</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">AtmosphereModel</span> <span class="o">=</span> <span class="n">JacchiaRoberts</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">HistoricWeatherSource</span> <span class="o">=</span> <span class="s1">&#39;ConstantFluxAndGeoMag&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">PredictedWeatherSource</span> <span class="o">=</span> <span class="s1">&#39;ConstantFluxAndGeoMag&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">CSSISpaceWeatherFile</span> <span class="o">=</span> <span class="s1">&#39;SpaceWeather-All-v1.2.txt&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">SchattenFile</span> <span class="o">=</span> <span class="s1">&#39;SchattenPredict.txt&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">F107</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">F107A</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">MagneticIndex</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">SchattenErrorModel</span> <span class="o">=</span> <span class="s1">&#39;Nominal&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">SchattenTimingModel</span> <span class="o">=</span> <span class="s1">&#39;NominalCycle&#39;</span><span class="p">;</span>
<span class="n">GMAT</span> <span class="n">TheForces</span><span class="o">.</span><span class="n">Drag</span><span class="o">.</span><span class="n">DragModel</span> <span class="o">=</span> <span class="s1">&#39;Spherical&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-integrator">
<h2>Configure the Integrator<a class="headerlink" href="#configure-the-integrator" title="Permalink to this headline">¶</a></h2>
<p>Finally, in order to propagate, we need an integrator. For this example,
we’ll use a Prince-Dormand 7(8) Runge-Kutta integrator. The propagator
is set using the code</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the propagation container that connect the integrator, force model, and spacecraft together</span>
<span class="n">pdprop</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;Propagator&quot;</span><span class="p">,</span><span class="s2">&quot;PDProp&quot;</span><span class="p">)</span>

<span class="c1"># Create and assign a numerical integrator for use in the propagation</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">gmat</span><span class="o">.</span><span class="n">Construct</span><span class="p">(</span><span class="s2">&quot;PrinceDormand78&quot;</span><span class="p">,</span> <span class="s2">&quot;Gator&quot;</span><span class="p">)</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">SetReference</span><span class="p">(</span><span class="n">gator</span><span class="p">)</span>

<span class="c1"># Set some of the fields for the integration</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;InitialStepSize&quot;</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">)</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">,</span> <span class="mf">1.0e-12</span><span class="p">)</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;MinStep&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="connect-the-objects-together">
<h2>Connect the Objects Together<a class="headerlink" href="#connect-the-objects-together" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign the force model imported from BasicFM</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">SetReference</span><span class="p">(</span><span class="n">fm</span><span class="p">)</span>

<span class="c1"># Setup the spacecraft that is propagated</span>
<span class="n">psm</span> <span class="o">=</span> <span class="n">pdprop</span><span class="o">.</span><span class="n">GetPropStateManager</span><span class="p">()</span>
<span class="n">psm</span><span class="o">.</span><span class="n">SetObject</span><span class="p">(</span><span class="n">sat</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize-the-system-and-propagate-a-step">
<h2>Initialize the System and Propagate a Step<a class="headerlink" href="#initialize-the-system-and-propagate-a-step" title="Permalink to this headline">¶</a></h2>
<p>Finally, the system can be initialized and fired to see a single
propagation step. Some of the code displayed here will be folded into
the API’s Initialize() function. For now, the steps needed to initialize
the system for a propagation step are:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform top level initialization</span>
<span class="n">gmat</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>

<span class="c1"># Refresh the object references from the propagator clones</span>
<span class="n">fm</span> <span class="o">=</span> <span class="n">pdprop</span><span class="o">.</span><span class="n">GetODEModel</span><span class="p">()</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">pdprop</span><span class="o">.</span><span class="n">GetPropagator</span><span class="p">()</span>

<span class="n">psm</span><span class="o">.</span><span class="n">BuildState</span><span class="p">()</span>

<span class="c1"># Pass the state manager to the dynamics model</span>
<span class="n">fm</span><span class="o">.</span><span class="n">SetPropStateManager</span><span class="p">(</span><span class="n">psm</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">SetState</span><span class="p">(</span><span class="n">psm</span><span class="o">.</span><span class="n">GetState</span><span class="p">())</span>

<span class="c1"># Assemble all of the force model objects together</span>
<span class="n">fm</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>

<span class="c1"># Finish the force model setup</span>
<span class="n">fm</span><span class="o">.</span><span class="n">BuildModelFromMap</span><span class="p">()</span>
<span class="n">fm</span><span class="o">.</span><span class="n">UpdateInitialData</span><span class="p">()</span>

<span class="c1"># Initialize the Propagator components</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
<span class="n">gator</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alternatively, the above code can be replaced with a call to the
PrepareInternals() function on the propagator. This also removes the need to
manually configure the PropagationStateManager. The condensed code can be seen
below:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform top level initialization</span>
<span class="n">gmat</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>

<span class="c1"># Setup the spacecraft that is propagated</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">AddPropObject</span><span class="p">(</span><span class="n">sat</span><span class="p">)</span>
<span class="n">pdprop</span><span class="o">.</span><span class="n">PrepareInternals</span><span class="p">()</span>

<span class="c1"># Refresh the object references from the propagator clones</span>
<span class="n">fm</span> <span class="o">=</span> <span class="n">pdprop</span><span class="o">.</span><span class="n">GetODEModel</span><span class="p">()</span>
<span class="n">gator</span> <span class="o">=</span> <span class="n">pdprop</span><span class="o">.</span><span class="n">GetPropagator</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>and we can then propagate, and start accumulating the data</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Take a 60 second step, showing the state before and after, and start buffering</span>
<span class="c1"># Buffers for the data</span>
<span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">vel</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">gatorstate</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">GetState</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gatorstate</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gatorstate</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
<span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">vel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting state:  &quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<span class="c1"># Take a step and buffer it</span>
<span class="n">gator</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mf">60.0</span><span class="p">)</span>
<span class="n">gatorstate</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">GetState</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">60.0</span>
<span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gatorstate</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gatorstate</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
<span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">vel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Propped state:   &quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Starting</span> <span class="n">state</span><span class="p">:</span>   <span class="mf">0.0</span> <span class="p">[</span><span class="o">-</span><span class="mf">5455.495852919224</span><span class="p">,</span> <span class="o">-</span><span class="mf">3637.0485868833093</span><span class="p">,</span> <span class="mf">2350.0571814448517</span><span class="p">]</span> <span class="p">[</span><span class="mf">3.1318014092807545</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.423940627548709</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.545227573417657</span><span class="p">]</span>
<span class="n">Propped</span> <span class="n">state</span><span class="p">:</span>    <span class="mf">60.0</span> <span class="p">[</span><span class="o">-</span><span class="mf">5256.1378692623475</span><span class="p">,</span> <span class="o">-</span><span class="mf">4014.4902800853415</span><span class="p">,</span> <span class="mf">2192.4488937848546</span><span class="p">]</span> <span class="p">[</span><span class="mf">3.51104729424038</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.153042432990329</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7064897093764597</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, we can run for a few orbits and show the results</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">360</span><span class="p">):</span>
    <span class="c1"># Take a step and buffer it</span>
    <span class="n">gator</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="mf">60.0</span><span class="p">)</span>
    <span class="n">gatorstate</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">GetState</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">60.0</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gatorstate</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gatorstate</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">vel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../../../_images/GMAT_Propagation_23_0.png" src="../../../../_images/GMAT_Propagation_23_0.png" />
<img alt="../../../../_images/GMAT_Propagation_23_1.png" src="../../../../_images/GMAT_Propagation_23_1.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Propagation with the GMAT API</a><ul>
<li><a class="reference internal" href="#prepare-the-gmat-environment">Prepare the GMAT Environment</a></li>
<li><a class="reference internal" href="#configure-a-spacecraft">Configure a Spacecraft</a></li>
<li><a class="reference internal" href="#configure-the-forces">Configure the Forces</a></li>
<li><a class="reference internal" href="#add-the-potential-field">Add the Potential Field</a></li>
<li><a class="reference internal" href="#add-the-other-forces">Add the other forces</a></li>
<li><a class="reference internal" href="#configure-the-integrator">Configure the Integrator</a></li>
<li><a class="reference internal" href="#connect-the-objects-together">Connect the Objects Together</a></li>
<li><a class="reference internal" href="#initialize-the-system-and-propagate-a-step">Initialize the System and Propagate a Step</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="GMAT_States.html"
                        title="previous chapter">State Management with the GMAT API</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../Bibliography.html"
                        title="next chapter">Bibliography</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/API/source/userguide/notebooks/GMAT_Propagation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../Bibliography.html" title="Bibliography"
             >next</a> |</li>
        <li class="right" >
          <a href="GMAT_States.html" title="State Management with the GMAT API"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">GMAT Tools and Extensions R2020a documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../apiIndex.html" >DRAFT GMAT API Design and User’s Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="notebooks.html" >API Notebook Walkthroughs</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018-2020, United States Government as represented by the Administrator of the National Aeronautics and Space Administration..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0" xml:id="DataAndConfiguration"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Data and Configuration</title>

  <para>Below we discuss the files and data distributed with GMAT and that are
  required for GMAT execution. GMAT requires many data files such as planetary
  ephemeris, Earth orientation data, leap second files and gravity files to
  name just a few. Below we describe how those files are organized and
  describe the controls provided so that you can customize the data files GMAT
  uses at run time.</para>

  <section>
    <title>File Structure</title>

    <para>The default directory structure for GMAT is shown below and is
    broken down into eight main directories. These directories organize the
    files and data used to run GMAT including binary libraries, data files,
    texture maps, to 3-D models among many others. The only two files in the
    GMAT root directory are the license.txt file and the README.txt file. A
    summary of the contents of each folder is described in further detail in
    the sections below.</para>

    <para><screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Util_DirectoryStructure.png"
                       scalefit="1" width="100%"></imagedata>
          </imageobject>

          <caption>
            <para>GMAT Directory Structure</para>
          </caption>
        </mediaobject>
      </screenshot></para>

    <section>
      <title>bin Folder</title>

      <para>The bin filder contains all binary files required for the core functionality
	  in GMAT (third-party, alpha and beta libraries are placed in the plugins folder).
      These libraries include the executable file (GMAT.exe on Windows, GMAT.app on Mac, etc.) and
      libraries for the GUI. The bin folder also
      contains two text files: gmat_startup_file.txt, and gmat.ini. The
      startup file is discussed in detail in a separate section below. The
      gmat.ini files is used to configure some GUI panels, set paths to
      external web links, and define "tool tip" messages. </para>
    </section>

    <section>
      <title>data Folder</title>

      <para>The data folder contains all data files required to run GMAT and
      is organized according to data types as shown in the figure below. The
      gravity folder contains a folder for each default central body modeled
      in GMAT and in those folders are files containing gravitational
      coefficients. The gui_config folder contains files for configuring some
      of the dialog boxes for GMAT Resources and Commands. These files allow
      you to custom configure a GUI for a user-provided plugin. Furthermore,
      some of the built-in dialog box designs employ an ini file for their
      configuration.</para>

      <para><screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Util_DirectoryStructure_Data.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>data Folder Structure</para>
            </caption>
          </mediaobject>
        </screenshot></para>

      <para>The graphics folder contains four subfolders: splash, stars, icons   and
      texture. The splash folder contains the GMAT splash screen that is
      displayed briefly while GMAT is initializing. The stars folder contains
      a star catalogue used for displaying stars in 3D graphics. The
      texture folder contains texture maps used for 3D graphics. The icons folder
	  contains graphics files for icons and images
      loaded at run time. These include the GMAT logo, images used on the
      about panel and welcome screen, and icons for the Toolbar, Resource Tree
      and Mission Tree.</para>
	  
	 <para> The planetary_coeff folder contains Earth Orientation
      Parameters (EOP) provided by the International Earth Rotation Service
      (IERS) and nutation coefficients for different nutation theories.
	  The planetary_ephem folder contains two folders: de and spk. The
      de folder contains the binary Digital Ephemeris DE405 files for the 8
      planets, the Moon, and pluto developed and distributed by JPL. The spk
      folder contains an spk kernel built from the DE421 file and kernels for
      selected comets, asteroids and moons. All ephemeris files distributed
      with GMAT are in the little-endian representation.</para>



      <para>The last two sub-folders in the data folder are time and vehicle.
      The time folder contains the JPL leap second kernel naif0009.tls and the
      GMAT leap second file tai-utc.dat. The vehicle folder contains two sub
      folders: ephem and models. The ephem subfolder contains SPK ephemeris
      files - including orbit, attitude, frame, and time kernels - for
      selected spacecraft. The models folder contains 3D model files.</para>
    </section>

    <section>
      <title>docs Folder</title>

      <para>Documentation for GMAT is contained in the docs folder and
      includes PDF versions of the User's Guide, Mathematical Specification,
      Design Specification, and Requirements Specification to name a few.
      There is also a subfolder named help that contains html help
      files.</para>
    </section>

    <section>
      <title>matlab Folder</title>

      <para>The matlab folder contains m-files required for GMAT's MATLAB
      interfaces including the interface to fmincon, and interfaces for
      driving GMAT from MATLAB. All files in the matlab folder must be
      included in your MATLAB path for the MATLAB interfaces to function
      properly.</para>
    </section>

    <section>
      <title>output Folder</title>

      <para>The output folder is the default location for file output such as
      ephemeris files and report files. If no path information is provided for
      reports or ephemeris files created during a GMAT session, then those
      files will be written to the output folder.</para>
    </section>
	
	<section>
      <title>plugins Folder</title>

      <para> The plugins folder is for third-party libraries and for functionality that is 
	  still in alpha or beta status.  A "proprietary" sub
      folder within the plugins directory is for third-party libraries that cannot
      be distributed as open source files and is an empty folder in the open
      source distribution.</para>
    </section>

    <section>
      <title>samples Folder</title>

      <para>The samples folder contains many sample missions ranging from
      Hohmann transfer to Libration point station-keeping, to Mars B-Plane
      targetting. These files are intended to demonstrate GMAT's capabilities
      and to provide you with potential staring points for building common
      mission types for your application and flight regime.</para>
    </section>

    <section>
      <title>userfunctions Folder</title>

      <para>The userfunctions folder contains two subfolders: gmat and matlab.
      These folders are where gmat and matlab functions are stored that are
      called in the GMAT command sequences for sample missions distributed
      with GMAT. You can also store your own custom GMAT and MATLAB functions
      in these folders.</para>
    </section>
  </section>

  <section>
    <title>Configuring GMAT Data Files</title>

    <para>You can configure the data files GMAT loads at run time by editing
    the file named gmat_startup_file.txt located in the bin directory. The
    startup file contains path information to files such as ephemeris, earth
    orientation data and graphics files among others. By editing the startup
    file, you can customize which files are loaded and used during a GMAT
    session. Below we describe the customization features available in the
    startup file. The order of lines in the startup file does not
    matter.</para>

    <section>
      <title>Leap Second and EOP files</title>

      <para>GMAT reads several files that are used for high fidelity modelling
      of time and coordinate systems. These files are the leap second files
      and the Earth Orientation Parameters (EOP) provided by the IERS. The EOP
      file is updated daily by the IERS. To update your local file with the
      latest data, simply replace the data in file eopc04.62-now, (located in
      the directory ./data/planetary_coeff/ ) with the data provided by the
      IERS in the link <link
      xlink:href="http://data.iers.org/products/177/11221/orig/eopc04_05_IAU2000.62-now">here</link>.
      There are two leap second files provided with GMAT. The file named
      naif0009.tls located in the .\data\time folder is used by the JPL SPICE
      libraries when computing ephemeredes. When a new leap seond is added,
      you can replace your old SPICE leap second file with the new file
      located here <link
      xlink:href="ftp://naif.jpl.nasa.gov/pub/naif/generic_kernels/lsk/">here</link>.</para>

      <para>GMAT reads the file tai-utc.dat in the .\data\time folder for all
      time computations requiring leap seconds that are not performed by the
      SPICE utilities. You can modify this file if a new leap second is added
      by simply duplicating the last row and updating it with the correct
      information for the new leap second. For example, if a new leapsecond
      were added on 01 Jul 2013, then you would add the following line to the
      tai-utc.dat file:</para>

      <para><code>2013 JUL 1 =JD 2456474.5 TAI-UTC= 35.0 S + (MJD - 41317.) X
      0.0</code></para>
    </section>

    <section>
      <title>Loading Custom Plugins</title>

      <para>Custom plugins are loaded by adding a line to your startup file
      describing the name and location of the plugin library. In order for a
      plugin to work with GMAT, the plugin library must be placed in the
      folder referenced in the startup file. You specify the path to a plugin
      using the "PLUGIN" keyword and specify the file by providing its name
      without the file extension (.dll on Windows). For example, to load a
      Windows plugin named libVF13Optimizer.dll located in the
      \bin\proprietary folder, you add this line to your startup file:</para>

      <para><code>PLUGIN = ./proprietary/libVF13Optimizer</code></para>
    </section>

    <section>
      <title>User-defined Function Paths</title>

      <para>If you create custom GMAT or MATLAB functions for your
      application, you can provide the path to those files and GMAT will
      locate them at run time. The default startup file is configured so you
      can place GMAT files in the ./userfunctions/gmat folder and place MATLAB
      functions in the /userfunctions/matlab folder GMAT automatically
      searches those locatations at run time. You can change the location of
      the search path to your GMAT or MATLAB functions by changing these lines
      in your startup file to reflect the location of your files with respect
      to the GMAT bin folder:</para>

      <programlisting> 
      GMAT_FUNCTION_PATH = ../userfunctions/gmat
      MATLAB_FUNCTION_PATH = ../userfunctions/matlab
</programlisting>

      <para>If you wish to organize your custom functions in multiple folders,
      you can add multiple search paths to the startup file. For
      example,</para>

      <programlisting> 
      GMAT_FUNCTION_PATH = ../MyFunctions/utils
      GMAT_FUNCTION_PATH = ../MyFunctions/StateConversion 
      GMAT_FUNCTION_PATH = ../MyFunctions/TimeConversion
</programlisting>
    </section>
  </section>

  <section>
    <title>Configuring the MATLAB Interfaces</title>

    <para>GMAT supports several MATLAB interfaces and to use these interfaces
    the following MATLAB folders must be added to your system path:</para>

    <programlisting> 
      MATLAB/bin/win32 
      MATLAB/bin 
      MATLAB/runtime/win32
    </programlisting>

    <caution>
      <para>The above folders are added to your system path during MATLAB
    installation. However, for some versions of MATLAB (2010a for example),
    MATLAB and Windows are distributed with 
    libraries that have the same name. This may cause the Windows libraries to 
	load instead of the MATLAB libraries. As a result, you may need to
    put the folders above at the beginning of your system path.</para>
    </caution>

    <para>If you have multilple versions of MATLAB installed, GMAT will use
    the version that appears first in your system path and that version must
    be registered as a COM server using the MATLAB regserver command.  To register
	the desired version of MATLAB, using a command prompt change directory to
	the bin folder of the desired MATLAB release and run the following command.</para>
	
	    <programlisting> 
      matlab.exe -regserver
</programlisting>

    <para>Finally you must add to your MATLAB path all files in the matlab directory which is located in
    the GMAT root directory.</para>
  </section>
</section>

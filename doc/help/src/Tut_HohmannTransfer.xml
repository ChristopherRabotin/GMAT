<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0" xml:id="DesigningaHohmannTransfer"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Designing a Hohmann Transfer</title>

  <section>
    <title>Objective and Overview</title>

    <para><emphasis role="bold">Final result:</emphasis> <link
    xlink:href="scripts/HohmannTransferDesign.script">HohmannTransferDesign.script</link></para>

    <para>The objective of this tutorial is to learn how to use differential
    correction (targeting) to perform a Hohmann transfer from a LEO parking
    orbit to a GEO mission orbit. In order to focus on the configuration of
    the differential correction process, you will make extensive use of the
    default configurations for spacecraft, propagators, and maneuvers. The
    target sequence employs two velocity-dirction maneuvers and two
    propagation sequences. The purpose of the first maneuver is to raise orbit
    apogee to 42165 km. The purpose of the second maneuver is to nearly
    circularize the orbit and yield a final eccentricity of 0.005. The
    differential corrector and associated commands are used to solve for the
    required maneuver magnitudes to reach the desired altitude eccentricity.
    The basic steps of this tutorial are:</para>

    <procedure>
      <step>
        <para>Create and configure a differential corrector.</para>
      </step>

      <step>
        <para>Modify the default OrbitView to visualize the trajectory.</para>
      </step>

      <step>
        <para>Create two default impulsive maneuvers.</para>
      </step>

      <step>
        <para>Add a target sequence to the mission to raise apogee to GEO
        altitude and circularize the orbit.</para>
      </step>

      <step>
        <para>Run the mission, save the solution, and rerun the mission using
        the converged solution.</para>
      </step>
    </procedure>
  </section>

  <section>
    <title>Creating and Configuring the Resource Tree</title>

    <para>Begin by loading the default mission ( click the new mission button
    in the toolbar) or starting a new GMAT session. For this tutorial, we will
    use the default configurations for a spaceraft (DefaultSC), a propagator
    (DefaultProp), and maneuvers. DefaultSC is configured to a near circular
    orbit and DefaultProp is configured to use Earth as the central body with
    a gravity model of degree and order 4. The default impulsive burn model
    uses the Velocity Normal Binormal (VNB) coordinate system. You may want to
    open the dialog boxes for these objects and inspect them more closely as
    we will leave the settings of those objects at their default
    values.</para>

    <section>
      <title>Creating the Differential Corrector</title>

      <procedure>
        <step>
          <para>Locate the Solvers folder in the Resource Tree and expand it
          if it is minimized.</para>
        </step>

        <step>
          <para>Right-click the Boundary Value Solvers folder, select Add, and
          then select DifferentialCorrector.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Modifying the default Orbit View</title>

      <para>We need to make minor modifications to default Orbit View so that
      the entire final orbit will fit in the graphics window.</para>

      <procedure>
        <step>
          <para>Double-click the DefaultOrbitView in the Resource Tree to open its dialog box. 
         (Or, you can right-click on it and select Open.)</para>
        </step>

        <step>
          <para>In the Drawing Option group box, change the Solver Iterations input field
           to the value Current.</para>
        </step>

        <step>
          <para>Change ViewPointVector to 0, 0, 90000 respectively.</para>
        </step>

        <step>
          <para>Change the ViewUpDefinition Axis to X.</para>
        </step>

        <step>
          <para>Verify the configuration against the screen capture below,
          make changes if needed, and click OK to save and close the
          dialog box.</para>
        </step>
      </procedure>

      <para><screenshot>
          <info>
            <title>Modifications to the Default OrbitView</title>
          </info>

          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Hohmann_DefaultOpenGL.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>Modifications to the Default OrbitView</para>
            </caption>
          </mediaobject>
        </screenshot></para>
    </section>

    <section>
      <title>Creating the Maneuvers.</title>

      <para>We need two default maneuvers for this tutorial. We will also
      rename the default maneuver and create a new maneuver:</para>

      <procedure>
        <step>
          <para>In the Burns folder in the Resource Tree, right-click on DefaultIB,
          select Rename, and change the name to dv1.</para>
        </step>

        <step>
          <para>Right-click on the Burns folder, select
          Add, and add ImpulsiveBurn.</para>
        </step>

        <step>
          <para>Right-click on the new ImpulsiveBurn, 
          select Rename, and change its name to dv2.</para>
        </step>
      </procedure>
    </section>
  </section>

  <section>
    <title>Configuring the Mission Tree</title>

    <para>The objective of the targeting sequence that we will create here is 
    to raise the orbit apogee to
    GEOsynchronous altitude (~42165km) and then circularize the orbit. We
    begin by modifying the intial propagate command to propagate to periapsis,
    then create the command structure, and finally configure each command.</para>

    <section>
      <title>Initial Propagate Sequence</title>

      <procedure>
        <step>
          <para>Left-click on the Mission tab to bring up the Mission
          Tree.</para>
        </step>

        <step>
          <para>Open the Propagate1 dialog box (by double-clicking it or by 
          right-clicking and then selecting Open from the menu).</para>
        </step>

        <step>
          <para>Locate the Stopping Conditions group box, and right-click
          on the line with text "DefaultSC.ElapsedSecs".
          This opens the Parameter Select Dialog box.</para>
        </step>

        <step>
          <para>Under the Object Properties list, locate periapsis and 
          double-click on it. Click OK to close the Parameter Select Dialog box.</para>
        </step>

        <step>
          <para>Your Propagate1 dialog box should now look as shown below. 
          Click OK to save and close it.</para>
        </step>
      </procedure>

      <screenshot>
        <info>
          <title>Figure: Propagate1 Propagate Command</title>
        </info>

        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_Hohmann_Propagate1PropagateCommand.jpeg"
                       scalefit="1" width="100%"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: Propagate1 Command</para>
          </caption>
        </mediaobject>
      </screenshot>

      <section>
        <title>Creating the Command Sequence</title>

        <para>To determine the delta Vs required to raise the orbit apogee to
        GEO altitude and then circularize the orbit, you will employ a
        Targeting loop. Let's begin by creating the commands necessary to
        perform the targeting sequence. The figure below illustrates the
        configuration of the Mission Tree after you have complete the steps
        in this section.</para>

        <screenshot>
          <info>
            <title>Figure: Mission Tree for Hohmann Transfer</title>
          </info>

          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Hohmann_MissionTree.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>Figure: The Mission Tree for a Hohmann Transfer</para>
            </caption>
          </mediaobject>
        </screenshot>

        <procedure>
          <step>
            <para>Right-click on Propagate1 in the Mission Tree, select Insert
            After, and select Target.</para>
          </step>

          <step>
            <para>Right-click on Target1, select Insert
            After, and select Vary.</para>
          </step>

          <step>
            <para>Right-click on Vary1, select Insert
            After, and select Manuever.</para>
          </step>

          <step>
            <para>Right-click on Maneuver1, select Insert
            After, and select Propagate.</para>
          </step>

          <step>
            <para>Right-click on Propagate2, select Insert
            After, and select Achieve.</para>
          </step>

          <step>
            <para>Right-click on Achieve1, select Insert
            After, and select Vary.</para>
          </step>

          <step>
            <para>Right-click on Vary2, select Insert
            After, and select Manuever.</para>
          </step>

          <step>
            <para>Right-click on Maneuver2, select Insert
            After, and select Propagate.</para>
          </step>

          <step>
            <para>Right-click on Propagate3, select Insert
            After, and select Achieve.</para>
          </step>
        </procedure>

        <para>Let us discuss the function of the command sequence
        created above. The Vary commands define variables that the differential
        corrector can modify to achieve the goals defined in the Achieve
        commands. Because there are two variables (Vary commands) and two
        Achieve commands (constraints), this is a "square" targeting problem.
        Below you will configure the Vary commands to modify the maneuver
        values to achieve a final orbit radius of 42165 km and an eccentricity of
        0.005</para>
      </section>

      <section>
        <title>Configuring the Command Sequence</title>

        <para>Now you will configure the commands you created above to solve
        for the delta-Vs required to perform a Hohmann transfer.</para>

        <procedure>
          <step>
            <para>Open the Target1 dialog box.
            Locate the ExitMode drop-down menu and set it to SaveAndContinue.
            This will save the converged solution of the targeting
            problem.</para>
          </step>

          <step>
            <para>Click OK to save and close the Target1 dialog box. (See the figure below.)</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Target1TargetCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Target1 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open the Vary1 dialog box in the Mission Tree.
            Notice that the variable in the Variable SetUp group is
            defined as dv1.Element1. This is the velocity component of dv1 in
            the local VNB system. That's what we need, so we'll keep it.</para>
          </step>

          <step>
            <para>Set the InitialValue to 1.0.</para>
          </step>

          <step>
            <para>Set the MaxStep to 0.5. Your Vary1 box should look as in figure below. 
            Click OK to save and close it.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Vary1VaryCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Vary1 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open the Maneuver1 command in the Mission Tree.
            Notice that the command is already set to apply dv1 to DefaultSC, so we don't
            need to change anything here. Click OK to save and close.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Maneuver1ManeuverCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Maneuver1 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open the Propagate2 dialog box. Use the
            procedure that we used in sections above to set the stopping condition
            to Apoapsis. Click OK to save and close.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Propagate2PropagateCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Propagate2 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open the <literal>Achieve1</literal> dialog box. Notice that the goal is set to
            DefaultSC.Earth.RMAG - which is what we need, so we make no changes here. 
            Click OK to save and close.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Achieve1AchieveCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Achieve1 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open Vary2 command.</para>
          </step>

          <step>
            <para>Click the Edit button next to Variable text box.</para>
          </step>

          <step>
            <para>Click on dv2 under the Object List.</para>
          </step>

          <step>
            <para>Double-click on Element1 under the ObjectProperties. (See the figure below.)</para>
          </step>

          <step>
            <para>Click OK to save and close the ParameterSelect dialog box.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_ParamSelectdV2.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Parameter Select for Vary2</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Locate the initial value text box and set it to 1.0.</para>
          </step>

          <step>
            <para>Locate the MaxStep text box and set it to 0.2. Click Ok to
            close the Vary1 dialog box.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Vary2VaryCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Vary2 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open the <literal>Maneuver2</literal> command in
            the Mission Tree.</para>
          </step>

          <step>
            <para>Locate the <literal>Burn</literal> field, change it
            to <literal>dv2</literal>. Click OK to save and close.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Maneuver2ManeuverCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Maneuver2 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Open the <literal>Propagate3</literal> command. Use the procedure 
             that we used above to set the stopping condition in the Parameter group to
            <literal>DefaultSC.ElapsedDays</literal>, with the Condition set to 1.0. box.
             (See the figure below.) Click OK to save and close.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Propagate3PropagateCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Propagate3 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>

          <step>
            <para>Finally, open the <literal>Achieve2</literal> command in the Mission
            Tree.</para>
          </step>

          <step>
            <para>Click on the Edit for the Goal text box.</para>
          </step>

          <step>
            <para>Double-click <literal> ECC </literal> in the Object Properties
            list. Click OK to close the Parameter Select Dialog Box.</para>
          </step>

          <step>
            <para>Change the <literal> Value </literal> to 0.005.</para>
          </step>

          <step>
            <para>Change the <literal> Tolerance </literal> to 0.0001. 
            (See the figure below.) Hit OK to save.</para>

            <screenshot>
              <mediaobject>
                <imageobject>
                  <imagedata align="center" contentdepth="100%"
                             fileref="files/images/Tut_Hohmann_Achieve2AchieveCommand.png"
                             scalefit="1" width="100%"></imagedata>
                </imageobject>

                <caption>
                  <para>Figure: Achieve2 Command</para>
                </caption>
              </mediaobject>
            </screenshot>
          </step>
        </procedure>
      </section>
    </section>
  </section>

  <section>
    <title>Running the Mission</title>

    <para>Before running the mission, click on the Save button in the toolbar
    and save your file to the desired location. Now click on the Run button in
    the Toolbar. As the mission is running, you will see the Differential
    Corrector try different maneuvers (shown in light blue). These are 
    Differential Corrector iterations and
    perturbation passes that attempt to determine the Jacobian of the two-point boundary
    value problem. After the mission is complete, the OrbitView should appear
    similar to the image shown below.</para>

    <screenshot>
      <mediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="100%"
                     fileref="files/images/Tut_Hohmann_OutputAfterFinalPropagateSequence.png"
                     scalefit="1" width="100%"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: Output After Final Propagate Sequence</para>
        </caption>
      </mediaobject>
    </screenshot>

    <para>You can save the resulting solution so that if you make small
    changes to the problem and retarget, the initial guess for subsequent runs
    will use the solution from your work above. .</para>

    <procedure>
      <step>
        <para>Double-click on Target1 in the Mission Tree.</para>
      </step>

      <step>
        <para>Left-click on Apply Corrections.</para>
      </step>

      <step>
        <para>Rerun the mission by clicking the Run button in the toolbar. If
        you inspect the results in the message window you should see that the
        targetting only took one iteration because it started from the
        solution!</para>
      </step>
    </procedure>
  </section>
</section>

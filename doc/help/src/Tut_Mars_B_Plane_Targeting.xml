<?xml version="1.0" encoding="UTF-8"?>
<chapter version="5.0" xml:id="Mars_B_Plane_Targeting"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Mars B-Plane Targeting</title>

  <variablelist>
    <varlistentry>
      <term>Audience</term>

      <listitem>
        <para>Advanced</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Length</term>

      <listitem>
        <para>75 minutes</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Prerequisites</term>

      <listitem>
        <para>Complete <xref linkend="SimulatingAnOrbit"
        xrefstyle="select:title"/>, <xref linkend="SimpleOrbitTransfer"
        xrefstyle="select:title"/> and a basic understanding of B-Planes and
        their usage in targeting is required.</para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term>Script File</term>

      <listitem>
        <para><filename>Tut_Mars_B_Plane_Targeting.script</filename></para>
      </listitem>
    </varlistentry>
  </variablelist>

  <section>
    <title>Objective and Overview</title>

    <note>
      <para>One of the most challenging problems in space mission design is to
      design an interplanetary transfer trajectory that takes the spacecraft
      within a very close vicinity of the target planet. One possible approach
      that puts the spacecraft close to a target planet is by targeting the
      B-Plane of that planet. The B-Plane is a planar coordinate system that
      allows targeting during a gravity assist. It can be thought of as a
      target attached to the assisting body. In addition, it must be
      perpendicular to the incoming asymptote of the approach hyperbola. <xref
      linkend="Tut_Mars_B_Plane_Targeting_B_Plane_1"/> and <xref
      linkend="Tut_Mars_B_Plane_Targeting_B_Plane_2"/> show the geometry of
      the B-Plane and B-vector as seen from a viewpoint perpendicular to orbit
      plane. To read more on B-Planes, please consult the GMATMathSpec
      document. A good example involving the use of B-Plane targeting is a
      mission to Mars. Sending a spacecraft to Mars can be achieved by
      performing a Trajectory Correction Maneuver (TCM) that targets Mars
      B-Plane. Once the spacecraft gets close to Mars, then an orbit insertion
      maneuver can be performed to capture into Mars orbit.</para>
    </note>
    <figure xml:id="Tut_Mars_B_Plane_Targeting_B_Plane_1">
      <title><guilabel>Geometry of the B-Plane</guilabel> as seen from a
      viewpoint perpendicular to the B-Plane</title>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_Mars_B_Plane_Targeting_B_Plane_1A.png"
                       scale="85"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </figure>

    <figure xml:id="Tut_Mars_B_Plane_Targeting_B_Plane_2">
      <title><guilabel>The B-vector</guilabel> as seen from a viewpoint
      perpendicular to orbit plane</title>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_Mars_B_Plane_Targeting_B_Plane_2.png"
                       scale="75"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </figure>

    <para>In this tutorial, we will use GMAT to model a mission to Mars.
    Starting from an out-going hyperbolic trajectory around Earth, we will
    perform a TCM to target Mars B-Plane. Once we are close to Mars, we will
    adjust the size of the maneuver to perform a Mars Orbit Insertion (MOI) to
    achieve a final elliptical orbit with an inclination of 90 degrees.
    Meeting these mission objectives requires us to create two separate
    targeting sequences. In order to focus on the configuration of the two
    targeters, we will make extensive use of the default configurations for
    spacecraft, propagators, and maneuvers.</para>

    <para>The first target sequence employs maneuvers in the Earth-based
    Velocity (V), Normal (N) and Bi-normal (B) directions and includes four
    propagation sequences. The purpose of the maneuvers in VNB directions is
    to target BdotT and BdotR components of the B-vector. BdotT is targeted to
    0 km and BdotR is targeted to a non-zero value to generate a polar orbit
    that has inclination of 90 degrees. BdotR is targeted to -7000 km to avoid
    having the orbit intersect Mars, which has a radius of approximately 3396
    km.</para>

    <para>The second target sequence employs a single, Mars-based
    anti-velocity direction (-V) maneuver and includes one propagation
    sequence. This single anti-velocity direction maneuver will occur at
    periapsis. The purpose of the maneuver is to achieve MOI by targeting
    position vector magnitude of 12,000 km at apoapsis. The basic steps of
    this tutorial are:</para>

    <procedure>
      <step>
        <para>Modify the <classname>DefaultSC</classname> to define
        spacecraft’s initial state. The initial state is an out-going
        hyperbolic trajectory that is with respect to Earth.</para>
      </step>

      <step>
        <para>Create and configure a <classname>Fuel Tank</classname>
        resource.</para>
      </step>

      <step>
        <para>Create two <classname>ImpulsiveBurn</classname> resources with
        default settings.</para>
      </step>

      <step>
        <para>Create and configure three <classname>Propagators:</classname>
        NearEarth, DeepSpace and NearMars</para>
      </step>

      <step>
        <para>Create and configure
        <classname>DifferentialCorrector</classname> resource.</para>
      </step>

      <step>
        <para>Create and configure three
        <classname>DefaultOrbitView</classname> resources to visualize Earth,
        Sun and Mars centered trajectories.</para>
      </step>

      <step>
        <para>Create and configure three
        <classname>CoordinateSystems:</classname> Earth, Sun and Mars
        centered.</para>
      </step>

      <step>
        <para>Create first <classname>Target</classname> sequence to target
        BdotT and BdotR components of the B-vector.</para>
      </step>

      <step>
        <para>Create second <classname>Target</classname> sequence to
        implement MOI by targeting position magnitude at apoapsis.</para>
      </step>

      <step>
        <para>Run the mission and analyze the results.</para>
      </step>
    </procedure>
  </section>

  <section>
    <title>Configure Fuel Tank, Spacecraft properties, Maneuvers, Propagators,
    Differential Corrector, Coordinate Systems and Graphics</title>

    <para>For this tutorial, you’ll need GMAT open, with the default mission
    loaded. To load the default mission, click <guiicon>New Mission</guiicon>
    (<inlinemediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="8pt"
                     fileref="files/images/icons/NewMission.png" width="1em"/>
        </imageobject>
      </inlinemediaobject>) or start a new GMAT session.
    <guilabel>DefaultSC</guilabel> will be modified to set spacecraft’s
    initial state as an out-going hyperbolic trajectory.</para>

    <section>
      <title>Create Fuel Tank</title>

      <para>We need to create a fuel tank in order to see how much fuel is
      expended after each impulsive burn. We will modify
      <guilabel>DefaultSC</guilabel> resource later and attach the fuel tank
      to the spacecraft.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, right-click the
          <guilabel>Hardware</guilabel> folder, point to
          <guilabel>Add</guilabel> and click <guilabel>Fuel Tank</guilabel>. A
          new resource called <guilabel>FuelTank1</guilabel> will be
          created.</para>
        </step>

        <step>
          <para>Right-click<guilabel>FuelTank1</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>In the<guilabel>Rename</guilabel> box, type
          <guilabel>MainTank</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double click on<guilabel>MainTank</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>MainTank</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="1.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Fuel Mass</guilabel></entry>

                    <entry><userinput>1718</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Fuel Density</guilabel></entry>

                    <entry><userinput>1000</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Pressure</guilabel></entry>

                    <entry><userinput>5000</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Volume</guilabel></entry>

                    <entry><userinput>2</userinput></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Modify the DefaultSC Resource</title>

      <para>We need to make minor modifications to
      <guilabel>DefaultSC</guilabel> in order to define spacecraft’s initial
      state and attach the fuel tank to the spacecraft.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, under
          <guilabel>Spacecraft</guilabel> folder, right-click
          <guilabel>DefaultSC</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Rename</guilabel> box, type
          <guilabel>MAVEN</guilabel> and click <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click on <guilabel>MAVEN</guilabel> to edit its
          properties. Make sure <guilabel>Orbit</guilabel> tab is
          selected.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>MAVEN</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="1.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Epoch Format</guilabel></entry>

                    <entry><guilabel>UTCGregorian</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Epoch</guilabel></entry>

                    <entry><userinput>18 Nov 2013
                    20:26:24.315</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Coordinate System</guilabel></entry>

                    <entry><guilabel>EarthMJ2000Eq</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>State Type</guilabel></entry>

                    <entry><guilabel>Keplerian</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>SMA</guilabel> under
                    <guilabel>Elements</guilabel></entry>

                    <entry><userinput>-32593.21599272796</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>ECC</guilabel> under
                    <guilabel>Elements</guilabel></entry>

                    <entry><userinput>1.202872548116185</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>INC</guilabel> under
                    <guilabel>Elements</guilabel></entry>

                    <entry><userinput>28.80241266404142</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>RAAN</guilabel> under
                    <guilabel>Elements</guilabel></entry>

                    <entry><userinput>173.9693759331483</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>AOP</guilabel> under
                    <guilabel>Elements</guilabel></entry>

                    <entry><userinput>240.9696529532764</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>TA</guilabel> under
                    <guilabel>Elements</guilabel></entry>

                    <entry><userinput>359.9465533778069</userinput></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click on <guilabel>Tanks</guilabel> tab now.</para>
        </step>

        <step>
          <para>Under <guilabel>Available Tanks</guilabel>, you'll see
          <guilabel>MainTank</guilabel>. This is the fuel tank that we created
          earlier.</para>
        </step>

        <step>
          <para>We attach <guilabel>MainTank</guilabel> to the spacecraft
          <guilabel>MAVEN</guilabel> by bringing it under <guilabel>Selected
          Tanks</guilabel> box. Select <guilabel>MainTank</guilabel> under
          <guilabel>Available Tanks</guilabel> and bring it over to the
          right-hand side under the <guilabel>Selected
          Tanks</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Create the Maneuvers</title>

      <para>We’ll need two <guilabel>ImpulsiveBurn</guilabel> resources for
      this tutorial. Below, we’ll rename the default ImpulsiveBurn and create
      a new one. We’ll also select the fuel tank that was created earlier in
      order to access fuel for the burns.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, under the
          <guilabel>Burns</guilabel> folder, right-click
          <guilabel>DefaultIB</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Rename</guilabel> box, type
          <guilabel>TCM</guilabel>, an acronym for Trajectory Correction
          Maneuver and click <guilabel>OK</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Double-Click <guilabel>TCM</guilabel> to edit its properties
          to edit its properties.</para>
        </step>

        <step>
          <para>Check <guilabel>Decrement Mass</guilabel> under <guilabel>Mass
          Change</guilabel>.</para>
        </step>

        <step>
          <para>For <guilabel>Tank</guilabel> field under <guilabel>Mass
          Change</guilabel>, select <guilabel>MainTank</guilabel> from drop
          down menu.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>

        <step>
          <para>Right-click the<guilabel>Burns</guilabel> folder, point to
          <guilabel>Add</guilabel>, and click
          <guilabel>ImpulsiveBurn</guilabel>. A new resource called
          <guilabel>ImpulsiveBurn1</guilabel> will be created.</para>
        </step>

        <step>
          <para><guilabel>Rename</guilabel> the new
          <guilabel>ImpulsiveBurn1</guilabel> resource to
          <guilabel>MOI</guilabel>, an acronym for Mars Orbit Insertion and
          click <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click <guilabel>MOI</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>For <guilabel>Origin</guilabel> field under
          <guilabel>Coordinate System</guilabel>, select
          <guilabel>Mars</guilabel>.</para>
        </step>

        <step>
          <para>Check <guilabel>Decrement Mass</guilabel> under <guilabel>Mass
          Change</guilabel>.</para>
        </step>

        <step>
          <para>For <guilabel>Tank</guilabel> field under <guilabel>Mass
          Change</guilabel>, select <guilabel>MainTank</guilabel> from the
          drop down menu.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Create the Propagators</title>

      <para>We’ll need to add three propagators for this tutorial. Below,
      we’ll rename the default <guilabel>DefaultProp</guilabel> and create two
      more propagators.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, under the
          <guilabel>Propagators</guilabel> folder, right-click
          <guilabel>DefaultProp</guilabel> and click Rename.</para>
        </step>

        <step>
          <para>In the <guilabel>Rename</guilabel> box, type
          <guilabel>NearEarth</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click on <guilabel>NearEarth</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>NearEarth</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="2.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Initial Step Size</guilabel> under
                    <guilabel>Integrator </guilabel></entry>

                    <entry><userinput>600</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Accuracy</guilabel> under <guilabel>
                    Integrator</guilabel></entry>

                    <entry><userinput>1e-013</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Min Step Size</guilabel> under
                    <guilabel>Integrator</guilabel></entry>

                    <entry><userinput>0</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Max Step Size</guilabel> under
                    <guilabel>Integrator</guilabel></entry>

                    <entry><userinput>600</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Model</guilabel> under <guilabel>Gravity
                    </guilabel></entry>

                    <entry><guilabel>JGM-2</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Degree</guilabel> under
                    <guilabel>Gravity</guilabel></entry>

                    <entry><userinput>8</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Order</guilabel> under
                    <guilabel>Gravity</guilabel></entry>

                    <entry><userinput>8</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Atmosphere Model</guilabel> under
                    <guilabel>Drag</guilabel></entry>

                    <entry><guilabel>None</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Point Masses</guilabel> under
                    <guilabel>Force Model</guilabel></entry>

                    <entry>Add <guilabel>Luna</guilabel> and
                    <guilabel>Sun</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Use Solar Radiation Pressure</guilabel>
                    under <guilabel>Force Model</guilabel></entry>

                    <entry><guilabel>Check this field</guilabel></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click on <guilabel>OK</guilabel> to save these changes.</para>
        </step>

        <step>
          <para>Right-click the <guilabel>Propagators</guilabel> folder and
          click <guilabel>Add Propagator</guilabel>. A new resource called
          <guilabel>Propagator1</guilabel> will be created.</para>
        </step>

        <step>
          <para><guilabel>Rename</guilabel> the new
          <guilabel>Propagator1</guilabel> resource to
          <guilabel>DeepSpace</guilabel> and click
          <guilabel>OK</guilabel>.<guilabel/></para>
        </step>

        <step>
          <para>Double-click <guilabel>DeepSpace</guilabel> to edit its
          properties<guilabel>.</guilabel></para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>DeepSpace</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="2.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Type</guilabel> under
                    <guilabel>Integrator </guilabel></entry>

                    <entry><guilabel>PrinceDormand78</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Initial Step Size</guilabel> under
                    <guilabel>Integrator </guilabel></entry>

                    <entry><userinput>600</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Accuracy</guilabel> under <guilabel>
                    Integrator</guilabel></entry>

                    <entry><userinput>1e-012</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Min Step Size</guilabel> under
                    <guilabel>Integrator</guilabel></entry>

                    <entry><userinput>0</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Max Step Size</guilabel> under
                    <guilabel>Integrator</guilabel></entry>

                    <entry><userinput>864000</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Central Body</guilabel> under
                    <guilabel>Force Model </guilabel></entry>

                    <entry><guilabel>Sun</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Primary Body</guilabel> under
                    <guilabel>Force Model</guilabel></entry>

                    <entry><guilabel>None</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Point Masses</guilabel> under
                    <guilabel>Force Model</guilabel></entry>

                    <entry>Add <guilabel>Earth, Luna, Sun, Mars, Jupiter,
                    Neptune, Saturn, Uranus, Venus</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Use Solar Radiation Pressure</guilabel>
                    under <guilabel>Force Model</guilabel></entry>

                    <entry><guilabel>Check this field</guilabel></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>

        <step>
          <para>Right-click the <guilabel>Propagators</guilabel> folder and
          click <guilabel>Add Propagator</guilabel>. A new resource called
          <guilabel>Propagator1</guilabel> will be created.</para>
        </step>

        <step>
          <para>Rename the new <guilabel>Propagator1</guilabel> resource to
          <guilabel>NearMars</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click on <guilabel>NearMars</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>NearMars</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="2.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Type</guilabel> under
                    <guilabel>Integrator </guilabel></entry>

                    <entry><guilabel>PrinceDormand78</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Initial Step Size</guilabel> under
                    <guilabel>Integrator </guilabel></entry>

                    <entry><userinput>600</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Accuracy</guilabel> under <guilabel>
                    Integrator</guilabel></entry>

                    <entry><userinput>1e-012</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Min Step Size</guilabel> under
                    <guilabel>Integrator</guilabel></entry>

                    <entry><userinput>0</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Max Step Size</guilabel> under
                    <guilabel>Integrator</guilabel></entry>

                    <entry><userinput>86400</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Central Body</guilabel> under
                    <guilabel>Force Model </guilabel></entry>

                    <entry><guilabel>Mars</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Primary Body</guilabel> under
                    <guilabel>Force Model</guilabel></entry>

                    <entry><guilabel>Mars</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Model</guilabel> under
                    <guilabel>Gravity</guilabel></entry>

                    <entry><guilabel>Mars-50C</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Degree</guilabel> under
                    <guilabel>Gravity</guilabel></entry>

                    <entry><userinput>8</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Order</guilabel> under
                    <guilabel>Gravity</guilabel></entry>

                    <entry><userinput>8</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Atmosphere Model</guilabel> under
                    <guilabel>Drag</guilabel></entry>

                    <entry><guilabel>None</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Point Masses</guilabel> under
                    <guilabel>Force Model</guilabel></entry>

                    <entry>Add <guilabel>Sun</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Use Solar Radiation Pressure</guilabel>
                    under <guilabel>Force Model</guilabel></entry>

                    <entry><guilabel>Check this field</guilabel></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save the changes.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Create the Differential Corrector</title>

      <para>Two <function>Target</function> sequences that we will create
      later need a <classname>DifferentialCorrector</classname> resource to
      operate, so let’s create one now. We'll leave the settings at their
      defaults.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, expand the
          <guilabel>Solvers</guilabel> folder if it isn’t already.</para>
        </step>

        <step>
          <para>Right-click the<guilabel> Boundary Value Solvers</guilabel>
          folder, point to <guilabel>Add</guilabel>, and click
          <guilabel>DifferentialCorrector</guilabel>. A new resource called
          <guilabel>DC1</guilabel> will be created.</para>
        </step>

        <step>
          <para><guilabel>Rename</guilabel> the new <guilabel>DC1</guilabel>
          resource to <guilabel>DefaultDC</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Create the Coordinate Systems</title>

      <para>The BdotT and BdotR constraints that we will define later under
      the first <guilabel>Target</guilabel> sequence require us to create a
      coordinate system. Orbit View resources that we will create later also
      need coordinate system resources to operate. We will create Sun and Mars
      centered coordinate systems. So let’s create them now.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, right-click the
          <guilabel>Coordinate Systems</guilabel> folder and click
          <guilabel>Add Coordinate System</guilabel>. A new Dialog box is
          created with a title <guilabel>New Coordinate
          System.</guilabel></para>
        </step>

        <step>
          <para>Type <guilabel>SunEcliptic</guilabel> under
          <guilabel>Coordinate System </guilabel><guilabel>Name</guilabel>
          box.</para>
        </step>

        <step>
          <para>Under <guilabel>Origin</guilabel> field, select
          <guilabel>Sun</guilabel>.</para>
        </step>

        <step>
          <para>For <guilabel>Type</guilabel> under <guilabel>Axes</guilabel>,
          select <guilabel>MJ2000Ec.</guilabel></para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes. You’ll
          see that a new coordinate system <guilabel>SunEcliptic</guilabel> is
          created under <guilabel>Coordinate Systems</guilabel> folder.</para>
        </step>

        <step>
          <para>Right-click the <guilabel>Coordinate Systems</guilabel> folder
          and click <guilabel>Add Coordinate System</guilabel>. A new Dialog
          Box is created with a title <guilabel>New Coordinate
          System</guilabel>.</para>
        </step>

        <step>
          <para>Type <guilabel>MarsInertial</guilabel> under
          <guilabel>Coordinate System Name</guilabel> box.</para>
        </step>

        <step>
          <para>Under <guilabel>Origin</guilabel> field, select
          <guilabel>Mars</guilabel>.</para>
        </step>

        <step>
          <para>For <guilabel>Type</guilabel> under <guilabel>Axes</guilabel>,
          select <guilabel>BodyInertial</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes. You’ll
          see that a new coordinate system <guilabel>MarsInertial
          </guilabel>is created under <guilabel>Coordinate Systems</guilabel>
          folder.</para>
        </step>
      </procedure>
    </section>

    <section>
      <title>Create the Orbit Views</title>

      <para>We’ll need three <guilabel>DefaultOrbitView</guilabel> resources
      for this tutorial. Below, we’ll rename the default
      <guilabel>DefaultOrbitView</guilabel> and create two new ones. We need
      three graphics windows in order to visualize spacecraft’s trajectory
      centered around Earth, Sun and then Mars</para>

      <procedure>
        <step>
          <para>In the <guilabel>Resources</guilabel> tree, under
          <guilabel>Output</guilabel> folder, right-click
          <guilabel>DefaultOrbitView</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Rename</guilabel> box, type
          <guilabel>EarthView</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Output</guilabel> folder, delete
          <guilabel>DefaultGroundTrackPlot</guilabel>.</para>
        </step>

        <step>
          <para>Double-click <guilabel>EarthView</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>EarthView</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="2.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>View Scale Factor</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><userinput>4</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Point Vector</guilabel> boxes, under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><userinput>0, 0, 30000</userinput></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>

        <step>
          <para>Right-click the <guilabel>Output</guilabel> folder, point to
          <guilabel>Add</guilabel>, and click <guilabel>OrbitView</guilabel>.
          A new resource called <guilabel>OrbitView1</guilabel> will be
          created.</para>
        </step>

        <step>
          <para><guilabel>Rename</guilabel> the new <guilabel>OrbitView1
          </guilabel>resource to <guilabel>SolarSystemView </guilabel>and
          click <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click <guilabel>SolarSystemView</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>SolarSystemView</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="2.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry>From <guilabel>Celestial Object</guilabel> under
                    <guilabel>View Object</guilabel>, add following objects to
                    <guilabel>Selected Celestial Object </guilabel>box</entry>

                    <entry><guilabel>Mars, Sun</guilabel> (Do not remove
                    <guilabel>Earth</guilabel>)</entry>
                  </row>

                  <row>
                    <entry><guilabel>Coordinate System</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><guilabel>SunEcliptic</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Point Reference</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><guilabel>Sun</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Point Vector</guilabel> boxes, under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><userinput>0, 0, 5e8</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Direction</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><guilabel>Sun</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>Coordinate System</guilabel> under
                    <guilabel>View Up Definition</guilabel></entry>

                    <entry><guilabel>SunEcliptic</guilabel></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>

        <step>
          <para>Right-click the <guilabel>Output </guilabel>folder, point to
          <guilabel>Add</guilabel>, and click <guilabel>OrbitView</guilabel>.
          A new resource called <guilabel>OrbitView1</guilabel> will be
          created.</para>
        </step>

        <step>
          <para><guilabel>Rename</guilabel> the new
          <guilabel>OrbitView1</guilabel> resource to
          <guilabel>MarsView</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click <guilabel>MarsView</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Set the values shown in the table below.</para>

          <para><table colsep="0" frame="topbot" rowsep="0">
              <title><guilabel>MarsView</guilabel> settings</title>

              <tgroup cols="2">
                <colspec colnum="1" colwidth="2.0*"/>

                <thead>
                  <row rowsep="1">
                    <entry>Field</entry>

                    <entry>Value</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry>From <guilabel>Celestial Object</guilabel> under
                    <guilabel>View Object</guilabel>, add following object to
                    <guilabel>Selected Celestial Object</guilabel> box</entry>

                    <entry><guilabel>Mars</guilabel> (You don’t have to remove
                    <guilabel>Earth</guilabel>)</entry>
                  </row>

                  <row>
                    <entry><guilabel>Coordinate System</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><guilabel>MarsInertial</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Point Reference</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><guilabel>Mars</guilabel></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Point Vector</guilabel> boxes, under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><userinput>22000, 22000, 0</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>View Direction</guilabel> under
                    <guilabel>View Definition</guilabel></entry>

                    <entry><userinput>Mars</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Coordinate System </guilabel>under
                    <guilabel>View Up Definition</guilabel></entry>

                    <entry><guilabel>MarsInertial</guilabel></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>

          <para/>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save the changes.</para>
        </step>
      </procedure>
    </section>
  </section>

  <section>
    <title>Configure the Mission Sequence</title>

    <para>Now we will configure first <guilabel>Target</guilabel> sequence to
    solve for the maneuver values required to achieve BdotT and BdotR
    components of the B-vector. BdotT will be targeted to 0 km and BdotR is
    targeted to a non-zero value in order to generate a polar orbit that will
    have an inclination of 90 degrees. To allow us to focus on the first
    <guilabel>Target</guilabel> sequence, we’ll assume you have already
    learned how to propagate an orbit by having worked through <xref
    linkend="SimulatingAnOrbit"/> tutorial.</para>

    <para>The second <guilabel>Target</guilabel> sequence will perform the MOI
    maneuver so that the spacecraft can orbit around Mars, but that sequence
    will be created later.</para>

    <section>
      <title>Create the First Target Sequence</title>

      <para>Now create the commands necessary to perform the first
      <guilabel>Target</guilabel> sequence. <xref
      linkend="Tut_Mars_B_Plane_Targeting_B_MissionTree_1"/> illustrates the
      configuration of the <guilabel>Mission</guilabel> tree after you have
      completed the steps in this section. We’ll discuss the first
      <guilabel>Target</guilabel> sequence after it has been created.</para>

      <figure xml:id="Tut_Mars_B_Plane_Targeting_B_MissionTree_1">
        <title>Mission Sequence for the First Target sequence</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Targeting_B_MissionTree_1.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>

      <para>To create the first <function>Target</function> sequence:</para>

      <procedure>
        <step>
          <para>Click on the <guilabel>Mission</guilabel> tab to show the
          <guilabel>Mission</guilabel> tree.</para>
        </step>

        <step>
          <para>You’ll see that there already exists a
          <guilabel>Propagate1</guilabel> command. We need to delete this
          command</para>
        </step>

        <step>
          <para>Right-click on <guilabel>Propagate1</guilabel> command and
          click <guilabel>Delete</guilabel>.</para>
        </step>

        <step>
          <para>Right-click on <guilabel>Mission Sequence</guilabel> folder,
          point to <guilabel>Append</guilabel>, and click
          <guilabel>Target</guilabel>. This will insert two separate commands:
          <guilabel>Target1</guilabel> and
          <guilabel>EndTarget1</guilabel>.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Target1</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>Type <guilabel>Target desired B-plane Coordinates</guilabel>
          and click <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Target desired B-plane
          Coordinates</guilabel>, point to <guilabel>Append</guilabel>, and
          click <guilabel>Propagate</guilabel>. A new command called
          <guilabel>Propagate1</guilabel> will be created.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Propagate1</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Rename</guilabel> box, type <guilabel>Prop 3
          Days</guilabel> and click <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Complete the <guilabel>Target</guilabel> sequence by appending
          the commands in <xref
          linkend="Tut_Mars_B_Plane_Targeting_CommandTable"/>.</para>

          <para><table colsep="0" frame="topbot" rowsep="0"
              xml:id="Tut_Mars_B_Plane_Targeting_CommandTable">
              <title>Additional First <guilabel>Target</guilabel> Sequence
              Commands</title>

              <tgroup cols="2">
                <thead>
                  <row rowsep="1">
                    <entry>Command</entry>

                    <entry>Name</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Propagate</guilabel></entry>

                    <entry><userinput>Prop 12 Days to TCM</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Vary</guilabel></entry>

                    <entry><userinput>Vary TCM.V</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Vary</guilabel></entry>

                    <entry><userinput>Vary TCM.N</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Vary</guilabel></entry>

                    <entry><userinput>Vary TCM.B</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Maneuver</guilabel></entry>

                    <entry><userinput>Apply TCM</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Propagate</guilabel></entry>

                    <entry><userinput>Prop 280 Days</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Propagate</guilabel></entry>

                    <entry><userinput>Prop to Mars
                    Periapsis</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Achieve</guilabel></entry>

                    <entry><userinput>Achieve BdotT</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Achieve</guilabel></entry>

                    <entry><userinput>Achieve BdotR</userinput></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>
        </step>
      </procedure>

      <note>
        <para>Let’s discuss what the first <guilabel>Target</guilabel>
        sequence does. We know that a maneuver is required to perform the
        B-Plane targeting. We also know that the desired B-Plane coordinate
        values for BdotT and BdotR are 0 and -7000 km, resulting in a polar
        orbit with 90 degree inclination. However, we don’t know the size (or
        ΔV magnitude) and direction of the <guilabel>TCM </guilabel>maneuver
        that will precisely achieve the desired orbital conditions. We use the
        <guilabel>Target</guilabel> sequence to solve for those precise
        maneuver values. We must tell GMAT what controls are available (in
        this case, three controls associated with three components of the TCM
        maneuver) and what conditions must be satisfied (in this case, BdotT
        and BdotR values). You accomplish this by using the
        <guilabel>Vary</guilabel> and <guilabel>Achieve</guilabel> commands.
        Using the <guilabel>Vary</guilabel> command, you tell GMAT what to
        solve for—in this case, the ΔV value and direction for
        <guilabel>TCM</guilabel>. You use the <guilabel>Achieve</guilabel>
        command to tell GMAT what conditions the solution must satisfy—in this
        case, BdotT and BdotR values that result in a 90 degree
        inclination.</para>
      </note>
    </section>

    <section>
      <title>Configure the First Target Sequence</title>

      <para>Now that the structure is created, we need to configure various
      parts of the first <guilabel>Target</guilabel> sequence to do what we
      want.</para>
    </section>

    <section>
      <title>Configure the Target desired B-plane Coordinates Command</title>

      <procedure>
        <step>
          <para>1Double-click <guilabel>Target desired B-plane
          Coordinates</guilabel> to edit its properties.</para>
        </step>

        <step>
          <para>In the <guilabel>ExitMode</guilabel> list, click
          <guilabel>SaveAndContinue</guilabel>. This instructs GMAT to save
          the final solution of the targeting problem after you run it.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Target desired B-plane</guilabel> Coordinates Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_TaregetDesired_B_plane_Coordinates.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Prop 3 Days Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Prop 3 Days</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Under <guilabel>Propagator</guilabel>, make sure that
          <guilabel>NearEarth</guilabel> is selected</para>
        </step>

        <step>
          <para>Under <guilabel>Parameter</guilabel>, replace
          <guilabel>MAVEN.ElapsedSeconds</guilabel> with
          <guilabel>MAVEN.ElapsedDays</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Condition</guilabel>, replace
          <guilabel>0.0</guilabel> with <guilabel>3</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Prop 3 Days</guilabel> Command Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Prop 3 Days.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Prop 12 Days to TCM Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Prop 12 Days to TCM</guilabel> to edit
          its properties.</para>
        </step>

        <step>
          <para>Under <guilabel>Propagator</guilabel>, replace
          <guilabel>NearEarth</guilabel> with
          <guilabel>DeepSpace</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Parameter</guilabel>, replace
          <guilabel>MAVEN.ElapsedSeconds</guilabel> with
          <guilabel>MAVEN.ElapsedDays</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Condition</guilabel>, replace
          <guilabel>0.0</guilabel> with <guilabel>12</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Prop 12 Days</guilabel> to TCM Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Prop 12 Days to TCM.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Vary TCM.V Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Vary TCM.V</guilabel> to edit its
          properties. Notice that the variable in the
          <guilabel>Variable</guilabel> box is
          <guilabel>TCM.Element1</guilabel>, which by default is the velocity
          component of <guilabel>TCM</guilabel> in the local
          Velocity-Normal-Binormal (VNB) coordinate system. That’s what we
          need, so we’ll keep it.</para>
        </step>

        <step>
          <para>In the <guilabel>Initial Value</guilabel> box, type
          <guilabel>1e-005</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Perturbation</guilabel> box, type
          <guilabel>0.00001</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Lower</guilabel> box, type
          <guilabel>-10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Upper</guilabel> box, type
          <guilabel>10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Max Step</guilabel> box, type
          <guilabel>0.002</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Vary TCM.V</guilabel> Command Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Vary TCMV.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Vary TCM.N Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Vary TCM.N</guilabel> to edit its
          properties. Notice that the variable in the
          <guilabel>Variable</guilabel> box is still
          <guilabel>TCM.Element1</guilabel>, which by default is the velocity
          component of TCM in the local VNB coordinate system. We need to
          insert <guilabel>TCM.Element2</guilabel> which is the normal
          component of TCM in the local VNB coordinate system. So let’s do
          that.</para>
        </step>

        <step>
          <para>Next to <guilabel>Variable</guilabel>, click the
          <guilabel>Edit</guilabel> button..</para>
        </step>

        <step>
          <para>Under <guilabel>Object</guilabel> List, click
          <guilabel>TCM</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Object Properties</guilabel> list,
          double-click <guilabel>Element2</guilabel> to move it to the
          <guilabel>Selected Value(s)</guilabel> list. See the image below for
          results.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to close the
          <guilabel>ParameterSelectDialog window</guilabel>.</para>
        </step>

        <step>
          <para>Notice that the variable in the <guilabel>Variable</guilabel>
          box is now <guilabel>TCM.Element2</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Initial Value</guilabel> box, type
          <guilabel>1e-005</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Perturbation</guilabel> box, type
          <guilabel>0.00001</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Lower</guilabel> box, type
          <guilabel>-10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Upper</guilabel> box, type
          <guilabel>10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Max Step</guilabel> box, type
          <guilabel>0.002</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Vary TCM.N</guilabel> Parameter Selection</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Vary TCM_N Parameter Select.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>

      <figure>
        <title><guilabel>Vary TCM.N</guilabel> Command Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Vary TCM_N Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Vary TCM.B Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Vary TCM.B</guilabel> to edit its
          properties. Notice that the variable in the
          <guilabel>Variable</guilabel> box is still
          <guilabel>TCM.Element1</guilabel>, which by default is the velocity
          component of TCM. We need to insert
          <guilabel>TCM.Element3</guilabel> which is the bi-normal component
          of TCM in the local VNB coordinate system. So let’s do that.</para>
        </step>

        <step>
          <para>Next to <guilabel>Variable</guilabel>, click the
          <guilabel>Edit</guilabel> button.</para>
        </step>

        <step>
          <para>Under <guilabel>Object</guilabel> List, click
          <guilabel>TCM</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Object Properties</guilabel> list,
          double-click <guilabel>Element3</guilabel> to move it to the
          <guilabel>Selected Value(s)</guilabel> list. See the image below for
          results.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to close the
          <guilabel>ParameterSelectDialog window</guilabel>.</para>
        </step>

        <step>
          <para>Notice that the variable in the <guilabel>Variable</guilabel>
          box is now <guilabel>TCM.Element3</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Initial Value</guilabel> box, type
          <guilabel>1e-005</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Perturbation</guilabel> box, type
          <guilabel>0.00001</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Lower</guilabel> box, type
          <guilabel>-10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Upper</guilabel> box, type
          <guilabel>10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Max Step</guilabel> box, type
          <guilabel>0.002</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Vary TCM.B</guilabel> Parameter Selection</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Vary TCM_B Parameter Select.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>

      <figure>
        <title><guilabel>Vary TCM.N</guilabel> Command Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Vary TCM_B Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Apply TCM Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Apply TCM</guilabel> to edit its
          properties. Notice that the command is already set to apply the
          <guilabel>TCM</guilabel> burn to the <guilabel>MAVEN</guilabel>
          spacecraft, so we don’t need to change anything here.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Apply TCM</guilabel> Command Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Apply TCM Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Prop 280 Days Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Prop 280 Days</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Under <guilabel>Propagator</guilabel>, replace
          <guilabel>NearEarth</guilabel> with
          <guilabel>DeepSpace</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Parameter</guilabel>, replace
          <guilabel>MAVEN.ElapsedSeconds</guilabel> with
          <guilabel>MAVEN.ElapsedDays</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Condition</guilabel>, replace
          <guilabel>0.0</guilabel> with <guilabel>280</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Prop 280 Days</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Prop 280 Days Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Prop to Mars Periapsis Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Prop to Mars Periapsis</guilabel> to
          edit its properties.</para>
        </step>

        <step>
          <para>Under <guilabel>Propagator</guilabel>, replace
          <guilabel>NearEarth</guilabel> with
          <guilabel>NearMars</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Parameter</guilabel>, replace
          <guilabel>MAVEN.ElapsedSeconds</guilabel> with
          <guilabel>MAVEN.Mars.Periapsis</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Prop to Mars Periapsis</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Prop to Mars Periapsis.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Achieve BdotT Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Achieve BdotT</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Next to <guilabel>Goal</guilabel>, click the
          <guilabel>Edit</guilabel> button.</para>
        </step>

        <step>
          <para>In the <guilabel>Object Properties</guilabel> list, click
          <guilabel>BdotT</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Coordinate System</guilabel>, select
          <guilabel>MarsInertial</guilabel> and double-click on
          <guilabel>BdotT</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to close the
          <guilabel>ParameterSelectDialog</guilabel> window.</para>
        </step>

        <step>
          <para>In the <guilabel>Value</guilabel> box, type
          <guilabel>0</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Tolerance</guilabel> box, type
          <guilabel>0.00001</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Achieve BdotT</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Achieve BdotT Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Achieve BdotR Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Achieve BdotR</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Next to <guilabel>Goal</guilabel>, click the
          <guilabel>Edit</guilabel> button.</para>
        </step>

        <step>
          <para>In the <guilabel>Object Properties</guilabel> list, click
          <guilabel>BdotR</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Coordinate System</guilabel>, select
          <guilabel>MarsInertial</guilabel> and double-click on
          <guilabel>BdotR</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to close the
          <guilabel>ParameterSelectDialog</guilabel> window.</para>
        </step>

        <step>
          <para>In the <guilabel>Value</guilabel> box, type
          <guilabel>-7000</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Tolerance</guilabel> box, type
          <guilabel>0.00001</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Achieve BdotR</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Achieve BdotR Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>
  </section>

  <section>
    <title>Run the Mission with first Target Sequence</title>

    <para>Before running the mission, click <guilabel>Save</guilabel>
    (<inlinemediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="8pt"
                     fileref="files/images/icons/SaveMission.png" width="1em"/>
        </imageobject>
      </inlinemediaobject>) and save the mission to a file of your
    choice. Now click <guilabel>Run</guilabel> (<inlinemediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="8pt"
                     fileref="files/images/icons/RunMission.png" width="1em"/>
        </imageobject>
      </inlinemediaobject>). As the mission runs, you will see
    GMAT solve the targeting problem. Each iteration and perturbation is shown
    in <guilabel>EarthView</guilabel>, <guilabel>SolarSystemView</guilabel>
    and <guilabel>MarsView</guilabel> windows in light blue, and the final
    solution is shown in red. After the mission completes, the 3D views should
    appear as in the images shown below. You may want to run the mission
    several times to see the targeting in progress.</para>

    <figure>
      <title>3D View of departure hyperbolic trajectory (EarthView)</title>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_Mars_B_Plane departure hyperbola EarthView_better.png"    
                       scalefit="1" width="100%"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </figure>

    <figure>
      <title>3D View of heliocentric transfer trajectory
      (SolarSystemView)</title>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_Mars_B_Plane departure hyperbola SolarSystemView.png"
                       scalefit="1" width="100%"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </figure>

    <figure>
      <title>3D View of approach hyperbolic trajectory. MAVEN stopped at
      periapsis (MarsView)</title>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_Mars_B_Plane departure hyperbola MarsView_1.png"
                       scalefit="1" width="100%"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </figure>

    <para>Since we are going to continue developing the mission tree by
    creating the second <function>Target</function> sequence, we will store
    the final solution of the first <function>Target</function> sequence as
    the initial conditions of the <guilabel>TCM</guilabel> resource. This is
    so that when you make small changes, the subsequent runs will take less
    time. To do this, follow these steps:</para>

    <procedure>
      <step>
        <para>In the <guilabel>Mission</guilabel> tree, double-click
        <guilabel>Target desired B-plane Coordinates</guilabel> to edit its
        properties.</para>
      </step>

      <step>
        <para>Click Apply Corrections.</para>
      </step>

      <step>
        <para>Click <guilabel>OK</guilabel> to save these changes.</para>
      </step>

      <step>
        <para>Now re-run the mission. If you inspect the results in the
        message window, you will see that the first
        <guilabel>Target</guilabel> sequence converges in one iteration. This
        is because you stored the solution as the initial conditions.</para>
      </step>

      <step>
        <para>In the <guilabel>Mission</guilabel> tree, double-click
        <guilabel>Vary TCM.V</guilabel>, <guilabel>Vary TCM.N</guilabel> and
        <guilabel>Vary TCM.B</guilabel>, you will notice that the values in
        Initial Value box have been updated to the final solution of the first
        <guilabel>Target</guilabel> sequence.</para>
      </step>
    </procedure>

    <para>If you want to know TCM maneuver’s delta-V vector values and how
    much fuel was expended during the maneuver, do the following steps:</para>

    <procedure>
      <step>
        <para>In the <guilabel>Mission</guilabel> tree, right-click
        <guilabel>Apply TCM</guilabel>, and click on <guilabel>Command
        Summary</guilabel>.</para>
      </step>

      <step>
        <para>Scroll down and under <literal>Maneuver Summary</literal>
        heading, values for delta-V vector are:</para>

        <para><literal>Delta V Vector:</literal></para>

        <para><literal>Element 1: 0.0039376963731 km/s</literal></para>

        <para><literal>Element 2: 0.0060423170483 km/s</literal></para>

        <para><literal>Element 3: -0.0006747125434 km/s</literal></para>
      </step>

      <step>
        <para>Scroll down and under <literal>Mass depletion from
        MainTank</literal> heading, <literal>Delta V</literal> and
        <literal>Mass Change</literal> tells you TCM maneuver’s magnitude and
        how much fuel was used for the maneuver:</para>

        <para><literal>Delta V: 0.0072436375569 km/s</literal></para>

        <para><literal>Mass change: -6.3128738639690 kg</literal></para>
      </step>

      <step>
        <para>Click <guilabel>OK</guilabel> to close <guilabel>Command
        Summary</guilabel> window.</para>
      </step>
    </procedure>

    <para>Just to make sure that the goals of first
    <guilabel>Target</guilabel> sequence were met successfully, let us access
    command summary for <guilabel>Prop to Mars Periapsis</guilabel> command by
    doing the following steps:</para>

    <procedure>
      <step>
        <para>In the <guilabel>Mission</guilabel> tree, right-click
        <guilabel>Prop to Mars Periapsis</guilabel>, and click on
        <guilabel>Command Summary</guilabel>.</para>
      </step>

      <step>
        <para>Under <guilabel>Coordinate System</guilabel>, select
        <guilabel>MarsInertial</guilabel>.</para>
      </step>

      <step>
        <para>Under <literal>Hyperbolic Parameters</literal> heading, see the
        values of <literal>BdotT</literal> and <literal>BdotR</literal>. Under
        <literal>Keplerian State</literal>, see the value for
        <literal>INC</literal>. You can see that the desired B-Plane
        coordinates were achieved which result in a 90 degree inclined
        trajectory:</para>

        <para><literal>BdotT = -0.0000053320678 km</literal></para>

        <para><literal>BdotR = -7000.0000019398 km</literal></para>

        <para><literal>INC = 90.000000039301 deg</literal></para>
      </step>
    </procedure>

    <section>
      <title>Create the Second Target Sequence</title>

      <para>Recall that we still need to create second
      <guilabel>Target</guilabel> sequence in order to perform Mars Orbit
      Insertion maneuver to achieve the desired capture orbit. In the
      <guilabel>Mission</guilabel> tree, we will create the second
      <guilabel>Target</guilabel> sequence right after the first
      <guilabel>Target</guilabel> sequence.</para>

      <para>Now let’s create the commands necessary to perform the second
      <guilabel>Target</guilabel> sequence. <xref
      linkend="Tut_Mars_B_Plane_Targeting_B_MissionTree_2"/> illustrates the
      configuration of the <guilabel>Mission</guilabel> tree after you have
      completed the steps in this section. Notice that in <xref
      linkend="Tut_Mars_B_Plane_Targeting_B_MissionTree_2"/>, the second
      <guilabel>Target</guilabel> sequence is created after the first
      <guilabel>Target</guilabel> sequence. We’ll discuss the second
      <guilabel>Target</guilabel> sequence after it has been created.</para>

      <figure xml:id="Tut_Mars_B_Plane_Targeting_B_MissionTree_2">
        <title>Mission Sequence showing first and second Target
        sequences</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Targeting_B_MissionTree_2.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>

      <para>To create the second <guilabel>Target</guilabel> sequence:</para>

      <procedure>
        <step>
          <para>Click on the <guilabel>Mission</guilabel> tab to show the
          <guilabel>Mission</guilabel> tree.</para>
        </step>

        <step>
          <para>In the <guilabel>Mission</guilabel> tree, right-click on
          <guilabel>Mission Sequence</guilabel> folder, point to
          <guilabel>Append</guilabel>, and click <guilabel>Target</guilabel>.
          This will insert two separate commands: <guilabel>Target2</guilabel>
          and <guilabel>EndTarget2</guilabel>.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Target2</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>Type <guilabel>Mars Capture</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Mars Capture</guilabel>, point to
          <guilabel>Append</guilabel>, and click <guilabel>Vary</guilabel>. A
          new command called <guilabel>Vary4</guilabel> will be
          created.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Vary4</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Rename</guilabel> box, type <guilabel>Vary
          MOI.V</guilabel> and click <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Complete the <guilabel>Target</guilabel> sequence by appending
          the commands in <xref
          linkend="Tut_Mars_B_Plane_Second_Targeting_CommandTable"/>.</para>

          <para><table colsep="0" frame="topbot" rowsep="0"
              xml:id="Tut_Mars_B_Plane_Second_Targeting_CommandTable">
              <title>Additional Second <guilabel>Target</guilabel> Sequence
              Commands</title>

              <tgroup cols="2">
                <thead>
                  <row rowsep="1">
                    <entry>Command</entry>

                    <entry>Name</entry>
                  </row>
                </thead>

                <tbody>
                  <row>
                    <entry><guilabel>Maneuver</guilabel></entry>

                    <entry><userinput>Apply MOI</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Propagate</guilabel></entry>

                    <entry><userinput>Prop to Mars
                    Apoapsis</userinput></entry>
                  </row>

                  <row>
                    <entry><guilabel>Achieve</guilabel></entry>

                    <entry><userinput>Achieve RMAG</userinput></entry>
                  </row>
                </tbody>
              </tgroup>
            </table></para>
        </step>
      </procedure>

      <note>
        <para>Let’s discuss what the second <guilabel>Target</guilabel>
        sequence does. We know that a maneuver is required for the Mars
        capture orbit. We also know that the desired radius of capture orbit
        at apoapsis must be 12,000 km. However, we don’t know the size (or ΔV
        magnitude) of the <guilabel>MOI</guilabel> maneuver that will
        precisely achieve the desired orbital conditions. You use the second
        <guilabel>Target</guilabel> sequence to solve for that precise
        maneuver value. You must tell GMAT what controls are available (in
        this case, a single maneuver) and what conditions must be satisfied
        (in this case, radius magnitude value). Once again, just like in the
        first <guilabel>Target</guilabel> sequence, here we accomplish this by
        using the <guilabel>Vary</guilabel> and <guilabel>Achieve</guilabel>
        commands. Using the <guilabel>Vary</guilabel> command, you tell GMAT
        what to solve for—in this case, the ΔV value for
        <guilabel>MOI</guilabel>. You use the <guilabel>Achieve</guilabel>
        command to tell GMAT what conditions the solution must satisfy—in this
        case, RMAG value of 12,000 km.</para>
      </note>
    </section>

    <section>
      <title>Create the Final Propagate Command</title>

      <para>We need a <guilabel>Propagate</guilabel> command after the second
      <guilabel>Target</guilabel> sequence so that we can see our final
      orbit.</para>

      <procedure>
        <step>
          <para>In the <guilabel>Mission</guilabel> tree, right-click
          <guilabel>End Mars Capture</guilabel>, point to <guilabel>Insert
          After</guilabel>, and click <guilabel>Propagate</guilabel>. A new
          <guilabel>Propagate6</guilabel> command will appear.</para>
        </step>

        <step>
          <para>Right-click <guilabel>Propagate6</guilabel> and click
          <guilabel>Rename</guilabel>.</para>
        </step>

        <step>
          <para>Type <guilabel>Prop for 1 day</guilabel> and click
          <guilabel>OK</guilabel>.</para>
        </step>

        <step>
          <para>Double-click <guilabel>Prop for 1 day</guilabel> to edit its
          properties.</para>
        </step>

        <step>
          <para>Under <guilabel>Propagator</guilabel>, replace
          <guilabel>NearEarth</guilabel> with
          <guilabel>NearMars</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Parameter</guilabel>, replace
          <guilabel>MAVEN.ElapsedSeconds</guilabel> with
          <guilabel>MAVEN.ElapsedDays</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Condition</guilabel>, replace the value
          <guilabel>0.0</guilabel> with <guilabel>1</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Prop for 1 day</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Prop For 1 Day.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the second Target Sequence</title>

      <para>Now that the structure is created, we need to configure various parts of the second <guilabel>Target</guilabel> sequence to do what we want.</para>

    </section>

    <section>
      <title>Configure the Mars Capture Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Mars Capture</guilabel> to edit its properties.</para>
        </step>

        <step>
          <para>In the <guilabel>ExitMode</guilabel> list, click <guilabel>SaveAndContinue</guilabel>. This instructs GMAT to save the final solution of the targeting problem after you run it.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes</para>
        </step>

      </procedure>

      <figure>
        <title><guilabel>Mars Capture</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Mars Capture.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Vary MOI.V Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Vary MOI.V</guilabel> to edit its
          properties. Notice that the variable in the
          <guilabel>Variable</guilabel> box is
          <guilabel>TCM.Element1</guilabel>. We want
          <guilabel>MOI.Element1</guilabel> which is the velocity component of <guilabel>MOI</guilabel> in the local VNB coordinate system. So let’s change that.</para>
        </step>

        <step>
          <para>Next to <guilabel>Variable</guilabel>, click the
          <guilabel>Edit</guilabel> button.</para>
        </step>

        <step>
          <para>Under <guilabel>Object</guilabel> List, click
          <guilabel>MOI</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Object Properties</guilabel> list,
          double-click <guilabel>Element1</guilabel> to move it to the
          <guilabel>Selected Value(s)</guilabel> list. See the image below for
          results.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to close the
          <guilabel>ParameterSelectDialog window</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Initial Value</guilabel> box, type
          <guilabel>-1.0</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Perturbation</guilabel> box, type
          <guilabel>0.00001</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Lower</guilabel> box, type
          <guilabel>-10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Upper</guilabel> box, type
          <guilabel>10e300</guilabel>.</para>
        </step>

        <step>
          <para>In the <guilabel>Max Step</guilabel> box, type
          <guilabel>0.1</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Vary MOI</guilabel> Parameter Selection</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane_Vary MOI_V Parameter Select.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>

      <figure>
        <title><guilabel>Vary MOI</guilabel> Command Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Vary MOI_V Command.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Apply MOI Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Apply MOI</guilabel> to edit its properties.</para>
        </step>

        <step>
          <para>In the <guilabel>Burn</guilabel> list, click <guilabel>MOI</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>

      </procedure>

      <figure>
        <title><guilabel>Apply MOI</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Apply MOI.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Prop to Mars Apoapsis Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Prop to Mars Apoapsis</guilabel> to edit its properties.</para>
        </step>

        <step>
          <para>Under <guilabel>Propagator</guilabel>, replace <guilabel>NearEarth</guilabel> with <guilabel>NearMars</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Parameter</guilabel>, replace <guilabel>MAVEN.ElapsedSeconds</guilabel> with <guilabel>MAVEN.Mars.Apoapsis</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>

      </procedure>

      <figure>
        <title><guilabel>Prop to Mars Apoapsis</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Prop to Mars Apoapsis.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

    <section>
      <title>Configure the Achieve RMAG Command</title>

      <procedure>
        <step>
          <para>Double-click <guilabel>Achieve RMAG</guilabel> to edit its properties.</para>
        </step>

        <step>
          <para>Next to <guilabel>Goal</guilabel>, click the <guilabel>Edit</guilabel> button.</para>
        </step>

        <step>
          <para>In the <guilabel>Object Properties</guilabel> list, click <guilabel>RMAG</guilabel>.</para>
        </step>

        <step>
          <para>Under <guilabel>Central Body</guilabel>, select <guilabel>Mars</guilabel> and double-click on <guilabel>RMAG</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to close the <guilabel>ParameterSelectDialog</guilabel> window.</para>
        </step>

        <step>
          <para>In the <guilabel>Value</guilabel> box, type <guilabel>12000</guilabel>.</para>
        </step>

        <step>
          <para>Click <guilabel>OK</guilabel> to save these changes.</para>
        </step>
      </procedure>

      <figure>
        <title><guilabel>Achieve RMAG</guilabel> Command
        Configuration</title>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_Mars_B_Plane Achieve RMAG.png"
                         scalefit="1" width="100%"/>
            </imageobject>
          </mediaobject>
        </screenshot>
      </figure>
    </section>

  </section>
 
  <section>
    <title>Run the Mission with first and second Target Sequences</title>

    <para>Before running the mission, click <guilabel>Save</guilabel>
    (<inlinemediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="8pt"
                     fileref="files/images/icons/SaveMission.png" width="1em"/>
        </imageobject>
      </inlinemediaobject>). This will save the additional changes that we implemented in the <guilabel>Mission</guilabel> tree.  Now click <guilabel>Run</guilabel> (<inlinemediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="8pt"
                     fileref="files/images/icons/RunMission.png" width="1em"/>
        </imageobject>
      </inlinemediaobject>). The first <guilabel>Target</guilabel> sequence will converge in one-iteration. 
      This is because earlier, we stored the solution as the initial conditions. The second <guilabel>Target</guilabel> sequence may converge after 10 to11 iterations.</para>


    <para>As the mission runs, you will see GMAT solve the second <guilabel>Target</guilabel> sequence’s targeting problem. 
	Each iteration and perturbation is shown in <guilabel>MarsView</guilabel> windows in light blue, and the final solution 
	is shown in red. After the mission completes, the <guilabel>MarsView</guilabel> 3D view should appear as in  the image shown below. 
	<guilabel>EarthView</guilabel> and <guilabel>SolarSystemView</guilabel> 3D views are same as before. You may want to run the mission several times to see the targeting in progress.</para>

    <figure>
      <title>3D view of Mars Capture orbit after MOI maneuver (MarsView)</title>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_Mars_B_Plane Mars Capture MarsView_2.png"
                       scalefit="1" width="100%"/>
          </imageobject>
        </mediaobject>
      </screenshot>
    </figure>


    <para>If you were to continue developing this mission, you can store the final solution
	of the second <guilabel>Target</guilabel> sequence as the initial condition of <guilabel>MOI</guilabel> resource. This is so that
	when you make small changes, the subsequent runs will take less time. To do this, follow these steps:</para>

    <procedure>
      <step>
        <para>In the <guilabel>Mission</guilabel> tree, double-click
        <guilabel>Mars Capture</guilabel> to edit its
        properties.</para>
      </step>

      <step>
        <para>Click Apply Corrections.</para>
      </step>

      <step>
        <para>Now re-run the mission. If you inspect the results in the message window, you will see that now
        the second <guilabel>Target</guilabel> sequence also converges in one iteration. This is because you stored the solution as the 
        initial condition. Now whenever you re-run the mission, both first and second Target sequences will converge in just one iteration.</para>
      </step>

      <step>
        <para>In the <guilabel>Mission</guilabel> tree, double-click
        <guilabel>Vary MOI.V</guilabel>, you will notice that the values in
        <guilabel>Initial Value</guilabel> box have been updated to the final solution of the second
        <guilabel>Target</guilabel> sequence.</para>
      </step>
    </procedure>

    <para>If you want to know MOI maneuver’s delta-V vector values and how
    much fuel was expended during the maneuver, do the following steps:</para>

    <procedure>
      <step>
        <para>In the <guilabel>Mission</guilabel> tree, right-click
        <guilabel>Apply MOI</guilabel>, and click on <guilabel>Command
        Summary</guilabel>.</para>
      </step>

      <step>
        <para>Scroll down and under <literal>Maneuver Summary</literal>
        heading, values for delta-V vector are:</para>

        <para><literal>Delta V Vector:</literal></para>

        <para><literal>Element 1:   -1.6034665169868 km/s</literal></para>

        <para><literal>Element 2:    0.0000000000000 km/s</literal></para>

        <para><literal>Element 3:    0.0000000000000 km/s</literal></para>
      </step>

      <step>
        <para>Scroll down and under <literal>Mass depletion from
        MainTank</literal> heading, <literal>Delta V</literal> and
        <literal>Mass Change</literal> tells you MOI maneuver’s magnitude and
        how much fuel was used for the maneuver:</para>

        <para><literal>Delta V:        1.6034665169868 km/s</literal></para>

        <para><literal>Mass change:   -1076.0639629424 kg</literal></para>
      </step>

    </procedure>

    <para>Just to make sure that the goal of second
    <guilabel>Target</guilabel> sequence was met successfully, let us access
    command summary for <guilabel>Achieve RMAG</guilabel> command by
    doing the following steps:</para>

    <procedure>
      <step>
        <para>In the <guilabel>Mission</guilabel> tree, right-click
        <guilabel>Achieve RMAG</guilabel>, and click on
        <guilabel>Command Summary</guilabel>.</para>
      </step>

      <step>
        <para>Under <guilabel>Coordinate System</guilabel>, select
        <guilabel>MarsInertial</guilabel>.</para>
      </step>

      <step>
        <para>Under <literal>Keplerian State</literal> and <literal>and Spherical State</literal> headings, see the
        values of <literal>TA</literal> and <literal>RMAG</literal>. You can see that the desired radius of the capture orbit at apoapsis was achieved successfully:</para>

        <para><literal>TA   =   180.00000241484 deg</literal></para>

        <para><literal>RMAG =   12000.019889021 km</literal></para>

      </step>
    </procedure>
  </section>
</chapter>

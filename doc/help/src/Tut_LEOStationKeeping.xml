<?xml version="1.0" encoding="UTF-8"?>
<section version="5.0" xml:id="LEOStationKeeping"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>LEO Station Keeping</title>

  <section>
    <title>Objective and Overview</title>

    <para><emphasis role="bold">Final result:</emphasis> <link
    xlink:href="scripts/HohmannTransferDesign.script">HohmannTransferDesign.script</link></para>

    <para>In this tutorial, you will learn how to use control flow and
    targeting in GMAT to maintain a Low-Earth orbit in the presense of drag.
    The area-to-mass ratio of the spacecraft is large to cause a rapid
    lowering of the orbit semimajor axis for the sake of simulation time.
    However, the process used in this script is useful for generating delta-V
    estimates for LEO stationkeeping of real-world missions. The basic steps
    of this tutorial are:</para>

    <procedure>
      <step>
        <para>Create and configure a spacecraft, impulsive maneuver,
        propagator, XYPlot, and differential corrector.</para>
      </step>

      <step>
        <para>Create a conditional loop using a while statement that
        propagates for 10 days.</para>
      </step>

      <step>
        <para>Run the mission and observe the behavior if there is no orbit
        control strategy.</para>
      </step>

      <step>
        <para>Create a target sequence nested in an if statement that executes
        if altitude is below 342 km.</para>
      </step>

      <step>
        <para>Run the mission and observe the behavior of orbit altitude with
        the control strategy implemented in step 4.</para>
      </step>
    </procedure>
  </section>

  <section>
    <title>Creating and Configuring the Resource Tree</title>

    <para>In this section, you will configure a model of a LEO spacecraft, a
    propopagator , a maneuver, and an XY plot to visualize the SMA during the
    control sequence developed in the next section.</para>

    <section>
      <title>Creating the Spacecraft</title>

      <procedure>
        <step>
          <para>Starting from the Resource Tree, right-click on DefaultSC,
          select rename, and change the name to LEOsat.</para>
        </step>

        <step>
          <para>Right-click on LEOSat, locate the EpochFormat combo box, and
          change the Epoch Format to UTCGregorian.</para>
        </step>

        <step>
          <para>Set the Epoch to 05 Jan 01 2010 00:00:00.000</para>
        </step>

        <step>
          <para>Set the state using the following values: X = -4083.9 , Y =
          4691.8 , Z = -2576.7 , VX = -4.252 , VY = -5.509 , VZ =
          -3.284</para>
        </step>

        <step>
          <para>Verify the configuration against the screen capture below,
          make any changes necessary, and click Ok on the LEOsat dialog
          box.</para>
        </step>
      </procedure>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_LEO_LEOsatSpacecraftObject.png"
                       scalefit="1" width="100%"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: LEOsat Spacecraft Object</para>
          </caption>
        </mediaobject>
      </screenshot>
    </section>

    <section>
      <title>Creating the Propagator</title>

      <procedure>
        <step>
          <para>Right-click on DefaultProp, select Rename, and change the name
          to LEOprop.</para>
        </step>

        <step>
          <para>Right-click on DefaultProp, and select Open.</para>
        </step>

        <step>
          <para>Locate the Drag Model group box and change the Atmosphere
          model to JacchiaRoberts.</para>
        </step>

        <step>
          <para>Click the select button to the right of the Point Masses list.
          Add the Sun, and Luna as Point Masses to the right-hand side list
          and click Ok.</para>
        </step>

        <step>
          <para>Check the Use Solar Radiation Pressure box</para>
        </step>

        <step>
          <para>Verify the configuration against the screen capture below,
          make any changes necessary, and click Ok on the LEOprop dialog
          box.</para>
        </step>
      </procedure>

      <screenshot>
        <mediaobject>
          <imageobject>
            <imagedata align="center" contentdepth="100%"
                       fileref="files/images/Tut_LEO_LEOpropPropagatorObject.png"
                       scalefit="1" width="100%"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: LEOprop Propagator Object</para>
          </caption>
        </mediaobject>
      </screenshot>
    </section>

    <section>
      <title>Creating the DifferentialCorrector and Maneuver</title>

      <para>We'll use the default configurations for a maneuver and a
      differential corrector so simply follow the steps below to create
      default configurations of those objects.</para>

      <procedure>
        <step>
          <para>Locate the Solvers folder under the Resource Tree and expand
          it if it is minimized.</para>
        </step>

        <step>
          <para>Right-click on the Boundary Value Solvers folder and select
          DifferentialCorrector.</para>
        </step>

        <step>
          <para>Rename the new Differential Corrector DC using steps described
          above.</para>
        </step>

        <step>
          <para>Right-click on DefaultIB in the Burns folder, select Rename,
          and change the name to DeltaV.</para>
        </step>
      </procedure>
    </section>
  </section>

  <section>
    <title>Creating and Configuring the Mission Sequence</title>

    <para>You will implement this mission in two parts. The first part is to
    add a While loop to the mission sequence, put a propagate sequence in the
    While loop, and configure the loop to propagate for about 10 days. At this
    point in the tutorial, there is no orbit control strategy implemented and
    upon running the mission you will see the SMA drop below the allowed value
    of 340 km. In the second part, you will implement a control sequence to
    ensure SMA remains above approximately 340 km. Below is an illustration of
    the Mission Tree after you have completed Part 1.</para>

    <screenshot>
      <mediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="100%"
                     fileref="files/images/Tut_LEO_TheMissionTreeStep1.png"
                     scalefit="1" width="100%"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: Mission Tree, Part I</para>
        </caption>
      </mediaobject>
    </screenshot>

    <procedure>
      <step>
        <para>Starting from the Mission Tree, right-click on Propagate1,
        select Insert After, locate Control Logic in the menu, and select
        While.</para>
      </step>

      <step>
        <para>Right-click on Propagate1 and select Delete.</para>
      </step>

      <step>
        <para>Right-click on While1, select Insert After, and select
        Propagate.</para>
      </step>

      <step>
        <para>After While1, insert another Propagate</para>
      </step>
    </procedure>

    <para>Now you will configure the While1 to continue if the ElapsedDays of
    LEOsat is less than 10 days and configure the Propagate2 command to take a
    single propagation step.</para>

    <procedure>
      <step>
        <para>Open the dialog box for the Propagate1 command.</para>
      </step>

      <step>
        <para>Double-left click in the Stopping Conditions
        <literal>Parameter</literal> field to select the text
        <literal>LEOSat.ElapsedSecs</literal>. Press the delete key to delete
        the text.</para>
      </step>

      <step>
        <para>Double-left click in the Stopping Conditions
        <literal>Condition</literal> field to select the text
        <literal>12000</literal>. Press the delete key to delete the
        text.</para>
      </step>

      <step>
        <para>Click OK to close the Propagate1 dialog box.</para>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_LEO_Propagate1PropagateCommand.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>Figure: Propagate1 Command</para>
            </caption>
          </mediaobject>
        </screenshot>
      </step>

      <step>
        <para>Open the dialog box for the While1 command.</para>
      </step>

      <step>
        <para>Notice that the left-hand side of the conditional statement is
        already set to <literal>LEOSat.ElapsedDays</literal> and the
        conditional operator is already set to "less-than". We will leave
        those fields at their default.</para>
      </step>

      <step>
        <para>Change the right-hand side text box to the value 10.0.</para>
      </step>

      <step>
        <para>Click OK to close the While1 dialog box.</para>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_LEO_While1WhileCommand.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>Figure: While1 Command</para>
            </caption>
          </mediaobject>
        </screenshot>
      </step>
    </procedure>

    <para>Now let's run the mission and observe the resulting altitude
    evolution by clicking Run in the Toolbar. You should see a plot that looks
    similar to the illustration below. Notice that the alttitude drops below
    the allowed value of 342 km. In the next part of this tutorial, you will
    implement a control strategy to prohibit altitude from breaking the
    constraint.</para>

    <screenshot>
      <mediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="100%"
                     fileref="files/images/Tut_LEO_OutputPart1.png"
                     scalefit="1" width="100%"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: Output After Part 1</para>
        </caption>
      </mediaobject>
    </screenshot>

    <para>Below you will implement a control strategy that performs a Hohmann
    transfer if altitude drops below 342 km. If you have not taken the Hohmann
    Transfer tutorial you may wish to do so now. Below we assume you have
    basic knowledge of how to configure a Hohmann transfer in GMAT and do not
    provide all detailed steps. The figure below illustrates the Mission Tree
    afer you have completed configuring the command sequence below.</para>

    <screenshot>
      <mediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="100%"
                     fileref="files/images/Tut_LEO_TheMissionTree.png"
                     scalefit="1" width="100%"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: Mission Tree, Part II</para>
        </caption>
      </mediaobject>
    </screenshot>

    <procedure>
      <step>
        <para>Add an If statement after the Propagate2 Command.</para>
      </step>

      <step>
        <para>Add a Vary statement inside of the Target1 Command.</para>
      </step>

      <step>
        <para>Add a Maneuver after the Vary1 Command.</para>
      </step>

      <step>
        <para>Add an Achieve command after the Vary1 Command.</para>
      </step>

      <step>
        <para>Add a Propagate command after the Achieve1 Command.</para>
      </step>

      <step>
        <para>Add a Vary Command after the Propagate3 Command.</para>
      </step>

      <step>
        <para>Add a Maneuver after the Vary2 Command.</para>
      </step>

      <step>
        <para>Add an Achieve after the Maneuver2 Command.</para>
      </step>
    </procedure>

    <para>Now you will configure the commands you created above to perform the
    Hohman transfer control sequence.</para>

    <procedure>
	
	<step><para> Open the dialog box for the If1 command</para>
	    </step>
		
		<step><para> Set the left-hand side value to LEOsat.Altitude</para></step>
	
		
		<step><para> Set the right-hand side value to 342 and click OK to close the If1 dialog box.</para>
	    <screenshot> 

      <mediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="100%"
                     fileref="files/images/Tut_LEO_If1IfCommand.png"
                     scalefit="1" width="100%"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: If1 Command</para>
        </caption>
      </mediaobject>
    </screenshot>

  </step>
      <step>
        <para>Open the dialog box for the Vary1 Command.</para>
      </step>

      <step>
        <para>Change the IntialValue field to 0.002 and click OK to
        close.</para>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_LEO_Vary1VaryCommand.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>Figure: Vary1 Command</para>
            </caption>
          </mediaobject>
        </screenshot>
      </step>

      <step>
        <para>Open the dialog box for the Achieve1 Command.</para>
      </step>

      <step>
        <para>Change the left hand side value to LEOsat.Earth.SMA.</para>
      </step>

      <step>
        <para>Change the right hand side to 6734 and then click OK to
        close.</para>

        <screenshot>
          <mediaobject>
            <imageobject>
              <imagedata align="center" contentdepth="100%"
                         fileref="files/images/Tut_LEO_Achieve1AchieveCommand.png"
                         scalefit="1" width="100%"></imagedata>
            </imageobject>

            <caption>
              <para>Figure: Achieve1 Command</para>
            </caption>
          </mediaobject>
        </screenshot>
      </step>


    </procedure>


</section>
  <section>
    <title>Running the Mission</title>

    <para>The views that you created are good for seeing how well the mission
    sequence is keeping LEOsat in its orbit. The SMA view shows some thickness
    to it while the RAAN view shows barely any at all. You may now try and
    change the mission parameters as outlined in the mission tree section to
    see how the spacecraft's drift is affected.</para>

    <screenshot>
      <mediaobject>
        <imageobject>
          <imagedata align="center" contentdepth="100%"
                     fileref="files/images/Tut_LEO_Output.png" scalefit="1"
                     width="100%"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: Output</para>
        </caption>
      </mediaobject>
    </screenshot>
  </section>
</section>

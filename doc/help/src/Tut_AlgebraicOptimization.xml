<?xml version="1.0" encoding="UTF-8"?>
<chapter version="5.0" xml:id="AlgebraicOptimization"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xmlns:db="http://docbook.org/ns/docbook">
  <title>Algebraic Optimization</title>

  <section>
    <title>Objective and Overview</title>

    <para>This tutorial finds the minimum value to satisfy a function. This
    tutorial is intended to show how GMAT's optimizer works. Uses of
    optimization in a true mission include minimizing the amount of fuel or
    minimum flight time required to achieve certain characteristics. Learning
    how to optimize a mission sequence also involves learning about
    optimizers, nonlinear constraints, and the minimize command.</para>

    <para>You can download the script file and run it beforehand to see the
    final results of this tutorial: <link
    xlink:href="scripts/Ex_AlgebraicOptimization.script">Ex_AlgebraicOptimization.script</link></para>

    <section>
      <title>Prerequisites</title>

      <itemizedlist>
        <listitem>
          <para>Basic Understanding of how to create and propagate a
          spacecraft, as in Tutorial <link
          linkend="CreatingandPropagatingaSpacecraft">Creating and Propagating
          a Spacecraft</link></para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Mission Description</title>

      <itemizedlist>
        <listitem>
          <para>Objective: The goal here is to find values of variables X1 and
          X2 that minimize a criterion function F, with a constraint that
          X1+X2=8, as follows:</para>

          <para>F = ( X1 - 2 )<superscript>2</superscript> + ( X2 - 2
          )<superscript>2</superscript></para>

          <para>G = X1 + X2</para>

          <para>G = 8</para>
        </listitem>

        <listitem>
          <para>Find: Values X1 and X2</para>
        </listitem>
      </itemizedlist>
    </section>
  </section>

  <section>
    <title>Creating and Configuring the Resource Tree</title>

    <section>
      <title>Objects Required</title>

      <itemizedlist>
        <listitem>
          <para>Optimizer: SQPfmincon</para>
        </listitem>

        <listitem>
          <para>Plots/Reports: Report Data</para>
        </listitem>

        <listitem>
          <para>Variables: X1, X2, F, G</para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Creating and Modifying Objects</title>

      <itemizedlist>
        <listitem>
          <para>Variables/Strings/Arrays</para>

          <itemizedlist>
            <listitem>
              <para>Variable X1 = 0</para>
            </listitem>

            <listitem>
              <para>Variable X2 = 0</para>
            </listitem>

            <listitem>
              <para>Variable F = 0</para>
            </listitem>

            <listitem>
              <para>Variable G = 0</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Solvers</para>

          <itemizedlist>
            <listitem>
              <para>SQPfmincon Optimizer (Figure below shows the resulting
              SQPfmincon window)</para>

              <itemizedlist>
                <listitem>
                  <para>Tol Fun = .0001</para>
                </listitem>

                <listitem>
                  <para>Tol Con = .0001</para>
                </listitem>

                <listitem>
                  <para>Tol X = .01</para>
                </listitem>

                <listitem>
                  <para>Max Fun Evals = 1000</para>
                </listitem>

                <listitem>
                  <para>Max Iter = 250</para>
                </listitem>

                <listitem>
                  <para>Diff Min Change = .000001</para>
                </listitem>

                <listitem>
                  <para>Diff Max Change = .01</para>
                </listitem>

                <listitem>
                  <para>Display : Iter</para>
                </listitem>

                <listitem>
                  <para>Diagnostics</para>
                </listitem>
              </itemizedlist>

              <screenshot>
                <info>
                  <title>Figure: SQPfmincon Boundary Value Solver
                  Object</title>
                </info>

                <mediaobject>
                  <imageobject>
                    <imagedata align="center"
                               fileref="files/images/Tut_AlgebraicOpt_SQPfminconBoundaryValueSolverObject.jpeg"></imagedata>
                  </imageobject>

                  <caption>
                    <para>Figure: SQPfmincon Boundary Value Solver
                    Object</para>
                  </caption>
                </mediaobject>
              </screenshot>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Plots/Reports</para>

          <itemizedlist>
            <listitem>
              <para>Data ReportFile</para>

              <itemizedlist>
                <listitem>
                  <para>Clear Parameter List</para>
                </listitem>

                <listitem>
                  <para>Saved at
                  ./output/SampleMissions/Ex_AlgebraicOptimization.report</para>
                </listitem>
              </itemizedlist>

              <screenshot>
                <info>
                  <title>Figure: Data ReportFile System Object</title>
                </info>

                <mediaobject>
                  <imageobject>
                    <imagedata align="center"
                               fileref="files/images/Tut_AlgebraicOpt_DataReportFileSystemObject.jpeg"></imagedata>
                  </imageobject>

                  <caption>
                    <para>Figure: Data ReportFile System Object</para>
                  </caption>
                </mediaobject>
              </screenshot>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
  </section>

  <section>
    <title>Creating and Configuring the Mission Tree</title>

    <section>
      <title>Resource Mission and Output Trees</title>

      <para>As said above, values X1 and X2 are variables of function F that
      is to be optimized. The sum of these values form a constraint G,
      G=X1+X2=8. The final values of F, X1, X2 are sent to a report
      file.</para>
    </section>

    <section>
      <title>Creating and Modifying Command Sequences</title>

      <para>Set up the command sequence as in the Optimize sequence below.
      Optimization is done in Equation1, via the optimization criterion
      function F, using the Matlab routine SQPfmincon. For the constraint G,
      since a function cannot be a constraint in itself, the value G is used.
      This is done in Equation2.</para>

      <itemizedlist>
        <listitem>
          <para>Optimize</para>

          <itemizedlist>
            <listitem>
              <para>Vary X1 using SQPfmincon</para>

              <itemizedlist>
                <listitem>
                  <para>Upper = 10, Lower = -10</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para>Vary X2 using SQPfmincon</para>

              <itemizedlist>
                <listitem>
                  <para>Upper = 10, Lower = -10</para>
                </listitem>
              </itemizedlist>
            </listitem>

            <listitem>
              <para>Equation1 F = ( X1 - 2 )<superscript>2</superscript> + (
              X2 - 2 )<superscript>2</superscript></para>
            </listitem>

            <listitem>
              <para>Minimize the value of F using SQPfmincon</para>
            </listitem>

            <listitem>
              <para>Equation2 G = X2 + X1</para>
            </listitem>

            <listitem>
              <para>Nonlinear Constraint G = 8 using SQPfmincon</para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Report to file Data the values of variables F, G, X1,
          X2</para>
        </listitem>
      </itemizedlist>

      <screenshot>
        <info>
          <title>Figure: Vary X1 Command</title>
        </info>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_AlgebraicOpt_VaryX1Command.jpeg"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: Vary X1 Command</para>
          </caption>
        </mediaobject>
      </screenshot>

      <screenshot>
        <info>
          <title>Figure: Equation1 Command</title>
        </info>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_AlgebraicOpt_Equation1Command.jpeg"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: Equation1 Command</para>
          </caption>
        </mediaobject>
      </screenshot>

      <screenshot>
        <info>
          <title>Figure: Nonlinear Constraint Command</title>
        </info>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_AlgebraicOpt_NonlinearConstraintCommand.jpeg"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: Nonlinear Constraint Command</para>
          </caption>
        </mediaobject>
      </screenshot>

      <screenshot>
        <info>
          <title>Figure: Minimize F Command</title>
        </info>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_AlgebraicOpt_MinimizeFCommand.jpeg"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: Minimize F Command</para>
          </caption>
        </mediaobject>
      </screenshot>

      <screenshot>
        <info>
          <title>Figure: Report Command</title>
        </info>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="files/images/Tut_AlgebraicOpt_ReportCommand.jpeg"></imagedata>
          </imageobject>

          <caption>
            <para>Figure: Report Command</para>
          </caption>
        </mediaobject>
      </screenshot>
    </section>
  </section>

  <section>
    <title>The resulting view of Resource, Mission, and Output Trees</title>

    <informaltable frame="none" colsep="none">
      <tgroup cols="3">
	  <colspec colname='c1'/>
		<colspec colname='c2'/>
		<colspec colname='c3'/>
        <tbody>
          <row>
            <entry><screenshot>
                <info>
                  <title>Figure: Algebraic Optimization Resource, Mission, and
                  Output Trees</title>
                </info>

                <mediaobject>
                  <imageobject>
                    <imagedata align="center"
                               fileref="files/images/Tut_AlgebraicOpt_AlgebraicOptimizationResourceMissionandOutputTrees1.jpeg"></imagedata>
                  </imageobject>
                </mediaobject>
              </screenshot></entry>

            <entry><screenshot>
                <info>
                  <title>Figure: Algebraic Optimization Resource, Mission, and
                  Output Trees</title>
                </info>

                <mediaobject>
                  <imageobject>
                    <imagedata align="center"
                               fileref="files/images/Tut_AlgebraicOpt_AlgebraicOptimizationResourceMissionandOutputTrees2.jpeg"></imagedata>
                  </imageobject>

                </mediaobject>
              </screenshot></entry>

            <entry><screenshot>
                <info>
                  <title>Figure: Algebraic Optimization Resource, Mission, and
                  Output Trees</title>
                </info>

                <mediaobject>
                  <imageobject>
                    <imagedata align="center"
                               fileref="files/images/Tut_AlgebraicOpt_AlgebraicOptimizationResourceMissionandOutputTrees3.jpeg"></imagedata>
                  </imageobject>

                </mediaobject>
              </screenshot></entry>
          </row>
		  <row>
			      <entry namest="c1" nameend="c3" align='center'>Figure: Algebraic Optimization Resource, Mission,
                    and Output Trees</entry>
			</row>
        </tbody>
      </tgroup>
    </informaltable>
  </section>

  <section>
    <title>Running the Mission</title>

    <para><link linkend="???">Resource Mission and Output Trees</link></para>

    <para>There is no plot for this mission sequence. Its results - values X1,
    X2, and the minimum value of the optimized function F - can be found by
    calling ReportFile Data.</para>

    <screenshot>
      <info>
        <title>Figure: Data ReportFile</title>
      </info>

      <mediaobject>
        <imageobject>
          <imagedata align="center"
                     fileref="files/images/Tut_AlgebraicOpt_DataReportFile.jpeg"></imagedata>
        </imageobject>

        <caption>
          <para>Figure: Data ReportFile</para>
        </caption>
      </mediaobject>
    </screenshot>
  </section>
</chapter>

//$Header$
//------------------------------------------------------------------------------
//                                  Toggle
//------------------------------------------------------------------------------
// GMAT: Goddard Mission Analysis Tool.
//
// Author: Darrel J. Conway
// Created: 2003/mm/dd
//
// Developed jointly by NASA/GSFC and Thinking Systems, Inc. under contract
// number S-67573-G
//
/**
 * Insert descriptive text here.
 *
 * @note Any notes here.
 */
//------------------------------------------------------------------------------




// Class automatically generated by Dev-C++ New Class wizard

#include "Toggle.hpp" // class's header file
#include "Publisher.hpp"

// class constructor
Toggle::Toggle() :
    GmatCommand         ("Toggle"),
    toggleState     (true),
    subscriberID    (parameterCount)
{
	++parameterCount;
}

// class destructor
Toggle::~Toggle()
{
	// insert your code here
}


Toggle::Toggle(const Toggle& t) :
    GmatCommand         (t),
    subscriberID    (t.subscriberID)
{
    parameterCount = t.parameterCount;
}


Toggle& Toggle::operator=(const Toggle& t)
{
    return *this;
}


void Toggle::InterpretAction(void)
{
/// @todo: Clean up this hack for the Toggle::InterpretAction method
    // Sample string:  "Toggle Report On"
    
    Integer loc = generatingString.find("Toggle", 0) + 6, end;
    const char *str = generatingString.c_str();
    while (str[loc] == ' ')
        ++loc;
    
    Integer cmd = generatingString.find("On", loc);
    while (generatingString.find("On", cmd+1) != std::string::npos)
        cmd = generatingString.find("On", cmd+1);
        
    if ((cmd == (Integer)std::string::npos) || (cmd <= (Integer)(generatingString.length() - 5))) {
        cmd = generatingString.find("Off", loc);
        while (generatingString.find("Off", cmd+1) != std::string::npos)
            cmd = generatingString.find("Off", cmd+1);
            
        if (cmd == (Integer)std::string::npos)
            throw CommandException("Must Toggle either 'On' or 'Off'");
        if (cmd > (Integer)(generatingString.length() - 6)) {
            toggleState = false;
        }
    }
    else
        if (cmd > (Integer)(generatingString.length() - 5)) {
            toggleState = true;
        }
            
    // Find the Subscriber list
    end = generatingString.find(" ", loc);
    std::string sName = generatingString.substr(loc, end-loc);
    subNames.push_back(sName);
}


bool Toggle::Execute(void)
{
    Subscriber *sub;
    
    for (StringArray::iterator s = subNames.begin(); s != subNames.end(); ++s) {
        sub = (Subscriber *)(*objectMap)[*s];
        if (sub) {
            sub->Activate(toggleState);
        }
    }
    
    char data[] = "Toggle executed\n\n";
    publisher->Publish(data, strlen(data));
    return true;
}



//------------------------------------------------------------------------------
//  GmatBase* Clone(void) const
//------------------------------------------------------------------------------
/**
 * This method returns a clone of the Toggle.
 *
 * @return clone of the Toggle.
 *
 */
//------------------------------------------------------------------------------
GmatBase* Toggle::Clone(void) const
{
   return (new Toggle(*this));
}

std::string Toggle::GetParameterText(const Integer id) const
{
    if (id == subscriberID)
        return "Subscriber";
    return GmatCommand::GetParameterText(id);
}


Integer Toggle::GetParameterID(const std::string &str) const
{
    if (str == "Subscriber")
        return subscriberID;
    return GmatCommand::GetParameterID(str);
}


Gmat::ParameterType Toggle::GetParameterType(const Integer id) const
{
    if (id == subscriberID)
        return Gmat::STRING_TYPE;
    return GmatCommand::GetParameterType(id);
}


std::string Toggle::GetParameterTypeString(const Integer id) const
{
    if (id == subscriberID)
        return PARAM_TYPE_STRING[Gmat::STRING_TYPE];
    return GmatCommand::GetParameterTypeString(id);
}


std::string Toggle::GetStringParameter(const Integer id) const
{
    if (id == subscriberID)
        return "List of subscribers";
    return GmatCommand::GetStringParameter(id);
}


bool Toggle::SetStringParameter(const Integer id, const std::string &value)
{
    if (id == subscriberID) {
        if (find(subNames.begin(), subNames.end(), value) == subNames.end()) {
            subNames.push_back(value);
            return true;
        }
        return false;
    }
    return GmatCommand::SetStringParameter(id, value);
}

